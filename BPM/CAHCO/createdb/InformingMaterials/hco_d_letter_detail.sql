CREATE SEQUENCE  "HCO_SEQ_LETTER_DTL_ID"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 582 CACHE 5 NOORDER  NOCYCLE ;

GRANT SELECT ON "HCO_SEQ_LETTER_DTL_ID" TO "MAXDAT_READ_ONLY";

CREATE TABLE HCO_S_LETTER_DETAIL_STG
(DimMailDetailsID NUMBER(10)
 ,DeIdentificationCIN VARCHAR2(9)
 ,CIN VARCHAR2(9)
 ,LetterStatus VARCHAR2(1)
 ,PlanType VARCHAR2(1)
 ,EnrollmentId NUMBER(10)
 ,ExemptionID NUMBER(10)
 ,BeneficiaryID NUMBER(10)
 ,RecordCreateDate DATE
 ,RecordCreateName VARCHAR2(50)
 ,DateLastModified DATE
 ,NameLastModified VARCHAR2(50)
 ,SpdStatus VARCHAR2(1)
 ,MaximusStatus VARCHAR2(1)
 ) TABLESPACE MAXDAT_DATA;
 
 GRANT SELECT ON "HCO_S_LETTER_DETAIL_STG" TO "MAXDAT_READ_ONLY";

CREATE INDEX HCOSLTRDTLSTG_IDX01 ON HCO_S_LETTER_DETAIL_STG (DimMailDetailsID) TABLESPACE MAXDAT_INDX;
CREATE INDEX HCOSLTRDTLSTG_IDX02 ON HCO_S_LETTER_DETAIL_STG (DeIdentificationCIN) TABLESPACE MAXDAT_INDX;
CREATE INDEX HCOSLTRDTLSTG_IDX03 ON HCO_S_LETTER_DETAIL_STG (BeneficiaryID) TABLESPACE MAXDAT_INDX;

CREATE TABLE HCO_D_LETTER_DETAIL(
DP_LETTER_DETAIL_ID NUMBER(10),
DIM_MAIL_DETAIL_ID NUMBER(10),
DCIN VARCHAR2(9),
CIN VARCHAR2(9),
LETTER_STATUS VARCHAR2(1),
PLAN_TYPE VARCHAR2(1),
ENROLLMENT_ID NUMBER(10),
EXEMPTION_ID NUMBER(10),
CLIENT_NUMBER NUMBER(10),
RECORD_DATE DATE,
RECORD_NAME VARCHAR2(50),
SPD_STATUS VARCHAR2(1),
MAXIMUS_STATUS VARCHAR2(1),
MODIFIED_DATE DATE,
MODIFIED_NAME VARCHAR2(50),
DATE_CREATED DATE,
DATE_UPDATED DATE,
CREATED_BY VARCHAR2(50),
UPDATED_BY VARCHAR2(50)) TABLESPACE MAXDAT_DATA;


ALTER TABLE "HCO_D_LETTER_DETAIL" ADD CONSTRAINT "LM_LTRDETAIL_PK" PRIMARY KEY ("DP_LETTER_DETAIL_ID") USING INDEX TABLESPACE "MAXDAT_INDX"  ENABLE;
CREATE INDEX HCOLTRDTL_IDX01 ON HCO_D_LETTER_DETAIL (DIM_MAIL_DETAIL_ID) TABLESPACE MAXDAT_INDX;
CREATE INDEX HCOLTRDTL_IDX02 ON HCO_D_LETTER_DETAIL (DCIN) TABLESPACE MAXDAT_INDX;
CREATE INDEX HCOLTRDTL_IDX03 ON HCO_D_LETTER_DETAIL (CLIENT_NUMBER) TABLESPACE MAXDAT_INDX;

GRANT SELECT ON "HCO_D_LETTER_DETAIL" TO "MAXDAT_READ_ONLY";
GRANT select, insert, update on HCO_D_LETTER_DETAIL to MAXDAT_OLTP_SIU;
GRANT select, insert, update, delete on HCO_D_LETTER_DETAIL to MAXDAT_OLTP_SIUD;

BEGIN
DBMS_ERRLOG.CREATE_ERROR_LOG ('HCO_D_LETTER_DETAIL','ERRLOG_LETTER_DETAIL');
END;
/

CREATE OR REPLACE TRIGGER "BUIR_LETTER_DETAIL" 
 BEFORE INSERT OR UPDATE
 ON hco_d_letter_detail
 FOR EACH ROW
DECLARE
    v_seq_id     HCO_D_LETTER_DETAIL.dp_letter_detail_id%TYPE;
BEGIN
  IF INSERTING THEN
    IF :NEW.dp_letter_detail_id IS NULL THEN
      SElECT HCO_SEQ_LETTER_DTL_ID.NEXTVAL
      INTO v_seq_id
      FROM dual;

      :NEW.dp_letter_detail_id       := v_seq_id;
    END IF;
    :NEW.date_created := sysdate;
    :NEW.created_by := user;
  END IF;
  
  :NEW.date_updated := sysdate;
  :NEW.updated_by := user;
END BUIR_LETTER_DETAIL;
/
ALTER TRIGGER "BUIR_LETTER_DETAIL" ENABLE;
/