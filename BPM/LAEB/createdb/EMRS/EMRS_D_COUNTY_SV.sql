DROP VIEW MAXDAT_SUPPORT.EMRS_D_COUNTY_SV;

CREATE OR REPLACE VIEW MAXDAT_SUPPORT.EMRS_D_COUNTY_SV
AS
SELECT 
    ec.value COUNTY_CODE ,
    ec.report_label COUNTY_NAME ,
    ec.attrib_fpis_code COUNTY_FIPS_CODE ,
    COALESCE(ec.attrib_district_cd, '-1') AS DISTRICT_ID,
    'LA' AS STATE,
    CASE
      WHEN ec.effective_end_date IS NULL
      AND ec.maximus_serves_ind = 1
      THEN 'A'
      ELSE 'I'
    END STATUS ,
    ec.update_ts MODIFIED_DATE ,
    TO_CHAR(ec.update_ts,'HH24MI') MODIFIED_TIME ,
    ec.updated_by MODIFIED_NAME 
  FROM eb.enum_county ec
  WHERE ec.effective_end_date IS NULL  
  AND ec.maximus_serves_ind = 1
UNION ALL
SELECT 
    '0' AS COUNTY_CODE ,
    'UNKNOWN' AS COUNTY_NAME ,
    NULL AS COUNTY_FIPS_CODE ,
    '-1' AS DISTRICT_ID ,
    'NA' AS STATE ,
    NULL AS STATUS ,
    NULL AS MODIFIED_DATE ,
    NULL AS MODIFIED_TIME ,
    NULL AS MODIFIED_NAME 
FROM DUAL;

GRANT SELECT ON MAXDAT_SUPPORT.EMRS_D_COUNTY_SV TO DP4BI_READ_ONLY;
GRANT SELECT ON MAXDAT_SUPPORT.EMRS_D_COUNTY_SV TO MAXDATSUPPORT_READ_ONLY;
GRANT SELECT ON MAXDAT_SUPPORT.EMRS_D_COUNTY_SV TO MAXDAT_SUPPORT_READ_ONLY;
