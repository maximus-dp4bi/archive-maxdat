-- Get the list of Identifiers, take the list of identifiers it should match the list in the statements below, 148 rows
select distinct identifier from maxdat.bpm_logging where bsl_id = 13 ;

-- Drop the temporary table if necessary
declare  c int;
 begin
    select count(*) into c from user_tables where table_name ='TMP_D_SCI_CURRENT';
    if c = 1 then
       execute immediate 'drop table TMP_D_SCI_CURRENT cascade constraints';
    end if;
 end;
 /
commit;

-- Create the temporary table to hold the d_sci_current records
create GLOBAL TEMPORARY TABLE maxdat.tmp_d_sci_current ON COMMIT PRESERVE ROWS as select * from maxdat.d_sci_current where 1=2 ;
commit;

-- Insert the backup records into the temp table
insert into maxdat.tmp_d_sci_current (select * from maxdat.d_sci_current where contact_record_id in (
6398469,
6398451,
6397647,
6397661,
6397632,
6397682,
6397694,
6397710,
6397729,
6397732,
6397665,
6397689,
6397650,
6397655,
6397726,
6397727,
6397728,
6397883,
6398476,
6397637,
6397639,
6397646,
6397627,
6397699,
6397717,
6397718,
6398047,
6397638,
6397670,
6397674,
6397675,
6397676,
6397711,
6397725,
6397683,
6397688,
6397656,
6397662,
6397731,
6397634,
6397667,
6397668,
6397630,
6397698,
6397719,
6397724,
6397733,
6397635,
6397636,
6397705,
6397722,
6397690,
6397660,
6397734,
6397890,
6398467,
6398473,
6398464,
6398462,
6397642,
6397643,
6397648,
6397657,
6397900,
6397671,
6397687,
6397693,
6397712,
6397720,
6397620,
6397673,
6397678,
6397707,
6397708,
6397692,
6397696,
6397640,
6397649,
6397664,
6397887,
6397896,
6398466,
6397633,
6397709,
6397723,
6397730,
6398046,
6397624,
6397631,
6397677,
6397702,
6397706,
6397716,
6397645,
6397651,
6397663,
6397884,
6398474,
6398475,
6398465,
6398454,
6398463,
6397653,
6397659,
6397619,
6397621,
6397623,
6397672,
6397697,
6397704,
6397713,
6397685,
6397686,
6397691,
6397695,
6397735,
6398050,
6398468,
6398461,
6397644,
6397666,
6397669,
6397681,
6397701,
6397882,
6397625,
6397629,
6397714,
6397715,
6397721,
6397680,
6397654,
6397886,
6397641,
6397652,
6397628,
6397885,
6397700,
6397703,
6398048,
6398051,
6397622,
6397626,
6397679,
6397684,
6397658,
6398049));
commit;

-- Delete rows from the D_SCI_CURRENT
Delete from maxdat.d_sci_current where contact_record_id in (
6398469,
6398451,
6397647,
6397661,
6397632,
6397682,
6397694,
6397710,
6397729,
6397732,
6397665,
6397689,
6397650,
6397655,
6397726,
6397727,
6397728,
6397883,
6398476,
6397637,
6397639,
6397646,
6397627,
6397699,
6397717,
6397718,
6398047,
6397638,
6397670,
6397674,
6397675,
6397676,
6397711,
6397725,
6397683,
6397688,
6397656,
6397662,
6397731,
6397634,
6397667,
6397668,
6397630,
6397698,
6397719,
6397724,
6397733,
6397635,
6397636,
6397705,
6397722,
6397690,
6397660,
6397734,
6397890,
6398467,
6398473,
6398464,
6398462,
6397642,
6397643,
6397648,
6397657,
6397900,
6397671,
6397687,
6397693,
6397712,
6397720,
6397620,
6397673,
6397678,
6397707,
6397708,
6397692,
6397696,
6397640,
6397649,
6397664,
6397887,
6397896,
6398466,
6397633,
6397709,
6397723,
6397730,
6398046,
6397624,
6397631,
6397677,
6397702,
6397706,
6397716,
6397645,
6397651,
6397663,
6397884,
6398474,
6398475,
6398465,
6398454,
6398463,
6397653,
6397659,
6397619,
6397621,
6397623,
6397672,
6397697,
6397704,
6397713,
6397685,
6397686,
6397691,
6397695,
6397735,
6398050,
6398468,
6398461,
6397644,
6397666,
6397669,
6397681,
6397701,
6397882,
6397625,
6397629,
6397714,
6397715,
6397721,
6397680,
6397654,
6397886,
6397641,
6397652,
6397628,
6397885,
6397700,
6397703,
6398048,
6398051,
6397622,
6397626,
6397679,
6397684,
6397658,
6398049);
commit;

-- Shutdown the BPM process
execute MAXDAT_ADMIN.CONFIG_QUEUE_JOB(13,2,'ENABLED','N');

-- Remove the OLD_DATA from the bpm_update_event_queue
update maxdat.bpm_update_event_queue
set OLD_DATA = null
where identifier in (
6398469,
6398451,
6397647,
6397661,
6397632,
6397682,
6397694,
6397710,
6397729,
6397732,
6397665,
6397689,
6397650,
6397655,
6397726,
6397727,
6397728,
6397883,
6398476,
6397637,
6397639,
6397646,
6397627,
6397699,
6397717,
6397718,
6398047,
6397638,
6397670,
6397674,
6397675,
6397676,
6397711,
6397725,
6397683,
6397688,
6397656,
6397662,
6397731,
6397634,
6397667,
6397668,
6397630,
6397698,
6397719,
6397724,
6397733,
6397635,
6397636,
6397705,
6397722,
6397690,
6397660,
6397734,
6397890,
6398467,
6398473,
6398464,
6398462,
6397642,
6397643,
6397648,
6397657,
6397900,
6397671,
6397687,
6397693,
6397712,
6397720,
6397620,
6397673,
6397678,
6397707,
6397708,
6397692,
6397696,
6397640,
6397649,
6397664,
6397887,
6397896,
6398466,
6397633,
6397709,
6397723,
6397730,
6398046,
6397624,
6397631,
6397677,
6397702,
6397706,
6397716,
6397645,
6397651,
6397663,
6397884,
6398474,
6398475,
6398465,
6398454,
6398463,
6397653,
6397659,
6397619,
6397621,
6397623,
6397672,
6397697,
6397704,
6397713,
6397685,
6397686,
6397691,
6397695,
6397735,
6398050,
6398468,
6398461,
6397644,
6397666,
6397669,
6397681,
6397701,
6397882,
6397625,
6397629,
6397714,
6397715,
6397721,
6397680,
6397654,
6397886,
6397641,
6397652,
6397628,
6397885,
6397700,
6397703,
6398048,
6398051,
6397622,
6397626,
6397679,
6397684,
6397658,
6398049);
commit;

-- BPM Queue should be reset
execute maxdat.MAXDAT_ADMIN.RESET_BPM_QUEUE_ROWS_BY_BSL_ID(13);

-- Restart the BPM Process
execute MAXDAT_ADMIN.CONFIG_QUEUE_JOB(13,2,'ENABLED','Y');

-- Monitor queue to insure records process successfully and the records exist in the F_SCI_BY_DATE and D_SCI_CURRENT tables, then delete the temporary table

-- Drop the temporary table
declare  c int;
 begin
    select count(*) into c from user_tables where table_name ='TMP_D_SCI_CURRENT';
    if c = 1 then
       execute immediate 'drop table TMP_D_SCI_CURRENT cascade constraints';
    end if;
 end;
 /
commit;
