UPDATE corp_etl_proc_letters
SET cancel_reason = 'Letter errored 9/16/2014 or earlier in prod'
   ,instance_status = 'Complete'
   ,complete_dt = sysdate
   ,stage_done_date = sysdate
   ,cancel_dt = sysdate
   ,cancel_by = 'TXEB-5096'
   ,cancel_method = 'Exception'
   ,status = 'Canceled'
   ,status_dt = sysdate
WHERE letter_request_id IN (1861932	,
5155039	,
5155105	,
5155348	,
5155481	,
5155518	,
5155532	,
5155549	,
5155803	,
5243769	,
5243858	,
5243920	,
5243997	,
5244019	,
5244041	,
5244206	,
5244356	,
5244544	,
5244578	,
5244599	,
5244766	,
5244807	,
5244930	,
5245184	,
5245201	,
5245282	,
5245299	,
5245301	,
5245360	,
5245499	,
5245554	,
5282533	,
5282764	,
5282921	,
5294357	,
5294395	,
5294461	,
5294668	,
5294749	,
5294786	,
5294869	,
5294885	,
5295064	,
5295089	,
5295426	,
5309972	,
5310017	,
5310072	,
5310281	,
5310708	,
5344439	,
5344461	,
5344512	,
5345398	,
5345453	,
5345633	,
5389179	,
5389361	,
5400946	,
5401062	,
5401084	,
5401366	,
5401395	,
5401478	,
5401557	,
5401603	,
5401786	,
5401827	,
5401888	,
5401932	,
5402418	,
5402531	,
5402606	,
5402821	,
5402893	,
5403154	,
5403491	,
5403688	,
5403800	,
5404069	,
5404153	,
5404345	,
5404368	,
5404389	,
5404437	,
5404645	,
5404751	,
5404806	,
5404851	,
5405041	,
5405424	,
5405601	,
5405776	,
5405884	,
5406008	,
5406042	,
5406208	,
5406242	,
5406392	,
5406497	,
5406567	,
5406897	,
5407034	,
5407035	,
5407180	,
5407342	,
5407427	,
5407677	,
5407709	,
5407761	,
5407862	,
5408156	,
5408246	,
5408318	,
5408394	,
5408397	,
5408481	,
5408576	,
5408592	,
5408603	,
5408728	,
5408787	,
5409002	,
5409026	,
5409049	,
5409427	,
5409592	,
5409679	,
5409706	,
5410020	,
5410183	,
5410214	,
5410397	,
5410698	,
5410753	,
5411141	,
5411259	,
5411314	,
5411340	,
5411454	,
5411687	,
5415316	,
5415400	,
5415576	,
5415611	,
5415868	,
5416086	,
5425809	,
5425896	,
5425904	,
5426094	,
5426154	,
5429141	,
5437622	,
5447324	,
5599745	,
5599868	,
5600107	,
5600207	,
5600324	,
5601143	,
5601251	,
5601584	,
5727183	,
5727225	,
5727450	,
5727704	,
5727764	,
5727801	,
5727864	,
5729078	,
5729203	,
5729215	,
5749454	,
5749582	,
5796848	,
6085144	,
6085201	,
6085877	,
6086090	,
6086827	,
6086878	,
6086988	,
6087710	,
6088907	,
6088920	,
6089078	,
6089126	,
6089138	,
6089231	,
6090088	,
6090155	,
6091408	,
6091520	,
6092406	,
6171466	,
6407398	,
6408020	,
6408128	,
6408687	,
6409301	,
6529770	,
6782522	,
6783106	,
6783997	,
6785722	,
6786214	,
6788200	,
6792243	,
6792758	,
6793574	,
6798842	,
6798961	,
7095783	,
7096118	,
11279683	,
11293781	,
11346614	,
11347493	,
11370989	,
11382690	,
11398422	,
11439899	,
11471371	,
11509648	,
11602431	,
11659103	,
11866434	,
11866720	,
11871804	,
11877299	,
11877935	,
11879236	,
16279355	,
16840904	
)
;

UPDATE corp_etl_proc_letters
SET cancel_reason = 'Letter rejected by mailhouse 12/10/2014 or earlier in prod'
   ,instance_status = 'Complete'
   ,complete_dt = sysdate
   ,stage_done_date = sysdate
   ,cancel_dt = sysdate
   ,cancel_by = 'TXEB-5096'
   ,cancel_method = 'Exception'
   ,status = 'Canceled'
   ,status_dt = sysdate
WHERE letter_request_id IN (
1791903	,
1772020	,
1793418	,
1805276	,
1823847	,
1823853	,
1803778	,
1863526	,
1863534	,
2537630	,
2537668	,
2537670	,
2537671	,
2537681	,
2537708	,
2537438	,
2537440	,
2537441	,
2537449	,
2537028	,
2537451	,
2537468	,
2537479	,
2537480	,
2537488	,
2537528	,
2537559	,
2521169	,
2537589	,
2537591	,
2537608	,
2537611	,
2537620	,
2537629	,
2516346	,
2516823	,
2507839	,
2507845	,
2538928	,
2538940	,
2538948	,
2538958	,
2538959	,
2538970	,
2538979	,
2542992	,
2537475	,
1848171	,
2537442	,
2537462	,
2537562	,
2537572	,
2537592	,
2537602	,
2537652	,
2537692	,
2542010	,
2538978	,
2542198	,
2543851	,
2538931	,
2538932	,
2538941	,
2538942	,
2538951	,
2538962	,
2538981	,
2541869	,
2543248	,
2571233	,
2536056	,
2537346	,
2537437	,
2537446	,
2537447	,
2537467	,
2537477	,
2537487	,
2537506	,
2537586	,
2537587	,
2537597	,
2537606	,
2537627	,
2537636	,
2537647	,
2537657	,
2537666	,
2537676	,
2537677	,
2532497	,
2532289	,
2538936	,
2538937	,
2538977	,
2519286	,
2543214	,
2528636	,
2528665	,
2527138	,
2524149	,
2526345	,
1863553	,
2516844	,
2542894	,
2537596	,
2517865	,
2528713	,
2543555	,
2543937	,
2519460	,
1849265	,
2559504	,
2563502	,
2519775	,
2537454	,
2537474	,
2537574	,
2537594	,
2537624	,
2555892	,
2531941	,
2600502	,
2534940	,
2535274	,
2537453	,
2537473	,
2537533	,
2537573	,
2537583	,
2537653	,
2537673	,
2537693	,
2600430	,
2600553	,
2538933	,
2538943	,
2538944	,
2538953	,
2538975	,
2587861	,
2598503	,
2600514	,
2600528	,
2537445	,
2537455	,
2537575	,
2537595	,
2537605	,
2537615	,
2537675	,
2570998	,
2532832	,
2538675	,
2536043	,
2599483	,
2536133	,
2600574	,
2600649	,
2600680	,
2583348	,
2600515	,
2588517	,
2600875	,
2588135	,
2584876	,
2373222	,
2373443	,
1728787	,
1729038	,
1729068	,
1729398	,
1730227	,
1730337	,
1729739	,
1814519	,
1873539	,
1729897	,
1728685	,
1728713	,
1728861	,
1729996	,
1728812	,
1728954	,
1730263	,
1730272	,
1729912	,
1729024	,
1729063	,
1729317	,
1728655	,
1774839	,
1729227	,
1728750	,
1728782	,
1729714	,
1729794	,
1729864	,
1729904	,
1729915	,
1730368	,
2376892	,
2375802	,
2375035	,
2374135	,
2374785	,
2374818	,
2373716	,
2381131	,
2381140	,
2381150	,
2381160	,
2381161	,
2381171	,
2381191	,
2381201	,
2381251	,
2381261	,
2381271	,
2381301	,
2381321	,
2373733	,
2376973	,
2381162	,
2381192	,
2381200	,
2381202	,
2381212	,
2381242	,
2381250	,
2381270	,
2381272	,
2381280	,
2381302	,
2381312	,
2381320	,
2381330	,
2381342	,
2381840	,
1729009	,
1729273	,
1729380	,
1729761	,
1729778	,
1729831	,
1729221	,
2380418	,
2381149	,
2381158	,
2381178	,
2381195	,
2381209	,
2381245	,
2381258	,
2381329	,
2382035	,
2382055	,
2383545	,
2381133	,
2519446	,
2533389	,
2381257	,
2381337	,
2382048	,
2533400	,
2535595	,
2536959	,
2537470	,
2537484	,
2537582	,
2537614	,
2537634	,
2537642	,
2538938	,
2538952	,
2538968	,
2538972	,
2525189	,
2529950	,
2534762	,
2537471	,
2537585	,
2537609	,
2537635	,
2537641	,
2537679	,
2537688	,
2538930	,
2538939	,
2538963	,
2541059	,
2542541	,
2543156	,
2381148	,
2381151	,
2381179	,
2381180	,
2381196	,
2381315	,
2381322	,
2537472	,
2537581	,
2537633	,
2538947	,
2537548	,
2537593	,
2537626	,
2537646	,
2537683	,
2538960	,
2541865	,
1728694	,
1729724	,
1729918	,
2537457	,
2537547	,
2538946	,
2381248	,
2381327	,
2381339	,
2537481	,
2538945	,
2537443	,
2537448	,
2537463	,
1728847	,
2373436	,
2380364	,
2381154	,
2381184	,
2381254	,
2381274	,
2381278	,
2381338	,
2524385	,
2567193	,
2600535	,
2600616	,
2600732	,
2600734	,
2600876	,
2381114	,
2381297	,
2381341	,
2537580	,
2376049	,
2381177	,
2381217	,
2381275	,
2381296	,
2381335	,
2382036	,
2382049	,
2382056	,
2383110	,
1729795	,
1729925	,
1730360	,
2381265	,
2537450	,
2537682	,
2374521	,
2375353	,
2375451	,
2533390	,
2536123	,
2536965	,
2537439	,
2537588	,
2537640	,
2537651	,
2378752	,
2381141	,
2381152	,
2381170	,
2381181	,
2381182	,
2381190	,
2538935	,
2538961	,
2542896	,
2381210	,
2381211	,
2381252	,
2381282	,
2381292	,
2381300	,
2381311	,
2381331	,
2381332	,
2381340	,
2379707	,
2380365	,
2381314	,
1729811	,
2381260	,
1728817	,
1730262	,
1730362	,
2374519	,
2378394	,
2384401	,
2382754	,
2382700	,
2383751	,
2381883	,
2381123	,
2381134	,
2381153	,
2381163	,
2381164	,
2381174	,
2381194	,
2382044	,
2382052	,
2381204	,
2381214	,
2381264	,
2381294	,
2381304	,
2381334	,
2381344	,
2376546	,
2381263	,
2381273	,
2381283	,
2381303	,
2381323	,
2381333	,
2384026	,
2381129	,
2381135	,
2381159	,
2381169	,
2381175	,
2381185	,
2381199	,
2381205	,
2381215	,
2381219	,
2381255	,
2381295	,
2381305	,
2381325	,
2381345	,
2384250	,
2382045	,
2382046	,
2377959	,
2381262	,
2381193	,
2381203	,
2381213	,
2381187	,
2381266	,
2381290	,
2381310	,
1728761	,
2381246	,
2381247	,
2381249	,
2381259	,
2381267	,
2381268	,
2381276	,
2381279	,
2381287	,
2381288	,
2381289	,
2381298	,
2381306	,
2381307	,
2381308	,
2381309	,
2381316	,
2381317	,
2381318	,
2381319	,
2381326	,
2381328	,
2381336	,
2381347	,
2383176	,
2382059	,
1728974	,
2381183	,
2381346	,
1728859	,
2529908	,
2381172	,
2381165	,
2538934	,
2537578	,
1729022	,
1729065	,
1729111	,
1728676	,
1728786	,
1728816	,
1728936	,
1729297	,
1729337	,
1729397	,
1729756	,
1729766	,
1729846	,
1730279	,
1730309	,
1730379	,
1729179	,
1730396	,
1729764	,
1729198	,
1729217	,
1729239	,
1730456	,
1729874	,
1729309	,
1729360	,
1730486	,
1729931	,
1729426	,
1728893	,
1729757	,
1729033	,
1729758	,
1729759	,
1729798	,
1729809	,
1729827	,
1728619	,
1728627	,
1728647	,
1728658	,
1728690	,
1729837	,
1729870	,
1729877	,
1729889	,
1729917	,
1729928	,
1730421	,
1730471	,
1728790	,
1728800	,
1728840	,
1729354	,
1728880	,
1728889	,
1729078	,
1729096	,
1730247	,
1730270	,
1730306	,
1729044	,
1729721	,
1729791	,
2381118	,
2381146	,
2381147	,
2381156	,
2381157	,
2381167	,
2381168	,
2381176	,
2381188	,
2381197	,
2381198	,
2381206	,
2381207	,
2381208	,
2381216	,
2381189	,
2381324	,
2381762	,
2382050	,
1729696	,
1730177	,
2381166	,
2381173	,
2381186	,
2381253	,
2381256	,
2381269	,
2381293	,
2381299	,
2381313	,
2381343	,
2537576	,
2537577	,
2537616	,
2537617	,
2537637	,
2542116	,
2600509	,
2381155	,
2381243	,
2537507	,
1728624	,
1729045	,
1729875	,
1729895	,
1730235	,
1730245	,
1730285	,
1728972	,
1728975	,
1729016	,
1729042	,
1729101	,
1727934	,
1729702	,
1730253	,
1729742	,
1728632	,
1730353	,
1728692	,
1729321	,
1729342	,
1729855	,
1730394	,
1728701	,
1729902	,
1728775	,
1728792	,
1728831	,
1728851	,
1728891	,
1728892	,
1728941	,
1728955	,
26830201	,
26830206	,
26830207	,
26857650	,
6723007	,
6723018	,
6723076	,
6723080	,
6723096	,
6723102	,
6723106	,
6723112	,
6723150	,
6723159	,
6723168	,
6723170	,
6723175	,
6723177	,
6723228	,
6723244	,
6723294	,
6723302	,
6723377	,
6723380	,
6723386	,
6723387	,
6723392	,
6723407	,
6723435	,
6723436	,
6723451	,
6723456	,
6723459	,
6723463	,
6723347	,
26829688	,
26829690	,
26829737	,
26829745	,
26829750	,
26829751	,
26829770	,
26829797	,
26829800	,
26829808	,
26829810	,
26829824	,
26829826	,
26829848	,
26829854	,
26829856	,
26829857	,
26829863	,
26829865	,
26829871	,
26829876	,
26829885	,
26829888	,
26829912	,
26829915	,
26829945	,
26829946	,
26829948	,
26829950	,
26829964	,
26829966	,
26829969	,
26829970	,
26829987	,
26829988	,
26830009	,
26830010	,
26830011	,
26830033	,
26830041	,
26830043	,
26830049	,
26830050	,
26830059	,
26830081	,
26830082	,
26830084	,
26830095	,
26830096	,
26830113	,
26830114	,
26830116	,
26830132	,
26830166	,
26830170	,
26830172	
);

commit;

 DECLARE  
  CURSOR temp_cur IS
  select letter_request_id, letter_response_file_date
  from d_pl_current
  where age_in_business_days > 100
  and letter_status = 'Sent'
  and instance_status = 'Active'
  and letter_response_file_date is not null;    

  TYPE t_tab IS TABLE OF temp_cur%ROWTYPE INDEX BY PLS_INTEGER;
  temp_tab t_tab;
  v_bulk_limit NUMBER := 500;

BEGIN  
   OPEN temp_cur;
   LOOP
     FETCH temp_cur BULK COLLECT INTO temp_tab LIMIT v_bulk_limit;
     EXIT WHEN temp_tab.COUNT = 0; -- Exit when missing rows
  
     BEGIN
       FORALL indx IN 1..temp_tab.COUNT
         update corp_etl_proc_letters
           set instance_status = 'Complete'
               ,complete_dt = temp_tab(indx).letter_response_file_date
               ,stage_done_date = sysdate
               ,status = 'Mailed'
               ,status_dt = temp_tab(indx).letter_response_file_date
               ,mailed_dt = temp_tab(indx).letter_response_file_date
               ,ased_receive_confirmation = temp_tab(indx).letter_response_file_date
               ,asf_receive_confirmation = 'Y'
               ,gwf_outcome = 'M'
		     where letter_request_id = temp_tab(indx).letter_request_id;		   
     END;
     COMMIT;
  END LOOP;
  COMMIT;
  CLOSE temp_cur;
END;