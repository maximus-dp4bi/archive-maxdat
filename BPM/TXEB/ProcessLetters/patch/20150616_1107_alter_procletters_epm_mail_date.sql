alter table letters_stg
add (LETTER_DEFINITION_ID NUMBER(18,0));

alter table corp_etl_proc_letters
add (EPM_MAIL_DT_FOR_CASE DATE
     ,LETTER_DEFINITION_ID NUMBER(18,0));
    
alter table CORP_ETL_PROC_LETTERS_OLTP 
add (EPM_MAIL_DT_FOR_CASE DATE
     ,BADADDR_STATUS_DATE DATE
     ,LETTER_DEFINITION_ID NUMBER(18,0));
    
alter table CORP_ETL_PROC_LETTERS_OLTP_T 
add (EPM_MAIL_DT_FOR_CASE DATE
     ,LETTER_DEFINITION_ID NUMBER(18,0));      
    
alter table CORP_ETL_PROC_LETTERS_WIP_BPM  
add (EPM_MAIL_DT_FOR_CASE DATE
     ,LETTER_DEFINITION_ID NUMBER(18,0));        


alter table CORP_ETL_PROC_LETTERS_WIP_T  
add (EPM_MAIL_DT_FOR_CASE DATE
     ,LETTER_DEFINITION_ID NUMBER(18,0));

alter table d_pl_current
add (EPM_MAIL_DATE_FOR_CASE DATE
     ,LETTER_DEFINITION_ID NUMBER(18,0));



create or replace view D_PL_CURRENT_SV as
select PL_BI_ID,
  LETTER_REQUEST_ID,
  CREATE_DATE,
  CREATED_BY,
  REQUEST_DATE,
  INSTANCE_STATUS,
  COALESCE(ld.letter_type, pl.letter_type) LETTER_TYPE,  
  PROGRAM,
  CASE_ID,
  COUNTY_CODE,
  ZIP_CODE,
  LANGUAGE,
  REPRINT,
  pl.REQUEST_DRIVER_TYPE,
  pl.REQUEST_DRIVER_TABLE,
  LETTER_STATUS,
  LETTER_STATUS_DATE,
  SENT_DATE,
  PRINT_DATE,
  MAILED_DATE,
  RETURN_DATE,
  RETURN_REASON,
  REJECTION_REASON,
  REQUEST_ERROR_REASON,
  TRANSMITTED_FILE_NAME,
  TRANSMITTED_FILE_DATE,
  LETTER_RESPONSE_FILE_NAME,
  LETTER_RESPONSE_FILE_DATE,
  LAST_UPDATE_DATE,
  LAST_UPDATED_BY_NAME,
  NEWBORN_FLAG,
  TASK_ID,
  CANCEL_DATE,
  CANCEL_BY,
  CANCEL_REASON,
  CANCEL_METHOD,
  COMPLETE_DATE,
  PROCESS_LTR_REQUEST_START_DATE,
  PROCESS_LTR_REQUEST_END_DATE,
  SEND_TO_MAIL_HOUSE_START_DATE,
  SEND_TO_MAIL_HOUSE_END_DATE,
  RECEIVE_CONFIRM_START_DATE,
  RECEIVE_CONFIRM_END_DATE,
  AGE_IN_BUSINESS_DAYS,
  AGE_IN_CALENDAR_DAYS,
  TIMELINESS_STATUS,
  JEOPARDY_STATUS,
  SLA_CATEGORY,
  SLA_DAYS,
  SLA_DAYS_TYPE,
  SLA_JEOPARDY_DATE,
  SLA_JEOPARDY_DAYS,
  SLA_TARGET_DAYS,
  VALIDATION_FLAG,
  OUTCOME_FLAG,
  WORK_REQUIRED_FLAG,
  PROCESS_LETTERS_FLAG,
  TRANSMIT_FLAG,
  CONFIRMATION_FLAG,
  SOURCE_COMPLETE_DATE,
  NEW_LETTER_REQUEST_ID,
  RESOLVE_RESP_START_DATE,
  RESOLVE_RESP_END_DATE,
  RESOLVE_RESP_FLAG,
  CREATED_BY_ID,
  LAST_UPDATED_BY_ID,
  CANCEL_BY_ID,
  ERROR_COUNT,
  LAST_ERRORED_DATE,
  LETTER_REJECTED_FLAG,
  LAST_ERROR_FIXED_BY,
  EPM_MAIL_DATE_FOR_CASE
from D_PL_CURRENT pl
 left outer join D_LETTER_DEFINITION ld
   on pl.letter_definition_id = ld.lmdef_id
with read only;

create or replace public synonym D_PL_CURRENT_SV for D_PL_CURRENT_SV;
grant select on D_PL_CURRENT_SV to MAXDAT_READ_ONLY;


UPDATE corp_etl_list_lkup
SET value = '''Voided'',''Combined Similar Requests'',''Overcome by Events'''
WHERE name = 'LETTER_STATUS_OTHR';

insert into CORP_ETL_CONTROL(name,VALUE_TYPE,value,DESCRIPTION,CREATED_TS,UPDATED_TS) 
values ('PL_BAD_ADDRESS_LAST_JOB_ID','N','0','Used to fetch Letters Bad address data from OLTP',sysdate,sysdate);

COMMIT;