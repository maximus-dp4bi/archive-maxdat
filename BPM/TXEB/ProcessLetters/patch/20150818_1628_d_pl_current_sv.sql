create or replace view D_PL_CURRENT_SV as
select PL_BI_ID,
  LETTER_REQUEST_ID,
  CREATE_DATE,
  CREATED_BY,
  REQUEST_DATE,
  INSTANCE_STATUS,
  pl.LETTER_TYPE,
  PROGRAM,
  CASE_ID,
  pl.COUNTY_CODE,
  ZIP_CODE,
  LANGUAGE,
  REPRINT,
  pl.REQUEST_DRIVER_TYPE,
  pl.REQUEST_DRIVER_TABLE,
  LETTER_STATUS,
  LETTER_STATUS_DATE,
  SENT_DATE,
  PRINT_DATE,
  MAILED_DATE,
  RETURN_DATE,
  RETURN_REASON,
  REJECTION_REASON,
  REQUEST_ERROR_REASON,
  TRANSMITTED_FILE_NAME,
  TRANSMITTED_FILE_DATE,
  LETTER_RESPONSE_FILE_NAME,
  LETTER_RESPONSE_FILE_DATE,
  LAST_UPDATE_DATE,
  LAST_UPDATED_BY_NAME,
  NEWBORN_FLAG,
  TASK_ID,
  CANCEL_DATE,
  CANCEL_BY,
  CANCEL_REASON,
  CANCEL_METHOD,
  COMPLETE_DATE,
  PROCESS_LTR_REQUEST_START_DATE,
  PROCESS_LTR_REQUEST_END_DATE,
  SEND_TO_MAIL_HOUSE_START_DATE,
  SEND_TO_MAIL_HOUSE_END_DATE,
  RECEIVE_CONFIRM_START_DATE,
  RECEIVE_CONFIRM_END_DATE,
  AGE_IN_BUSINESS_DAYS,
  AGE_IN_CALENDAR_DAYS,
  TIMELINESS_STATUS,
  JEOPARDY_STATUS,
  SLA_CATEGORY,
  SLA_DAYS,
  SLA_DAYS_TYPE,
  SLA_JEOPARDY_DATE,
  SLA_JEOPARDY_DAYS,
  SLA_TARGET_DAYS,
  VALIDATION_FLAG,
  OUTCOME_FLAG,
  WORK_REQUIRED_FLAG,
  PROCESS_LETTERS_FLAG,
  TRANSMIT_FLAG,
  CONFIRMATION_FLAG,
  SOURCE_COMPLETE_DATE,
  NEW_LETTER_REQUEST_ID,
  RESOLVE_RESP_START_DATE,
  RESOLVE_RESP_END_DATE,
  RESOLVE_RESP_FLAG,
  CREATED_BY_ID,
  LAST_UPDATED_BY_ID,
  CANCEL_BY_ID,
  ERROR_COUNT,
  LAST_ERRORED_DATE,
  LETTER_REJECTED_FLAG,
  LAST_ERROR_FIXED_BY,
  EPM_MAIL_DATE_FOR_CASE,
  pl.LETTER_DEFINITION_ID,
  csda_code,
  csda_name,
  (SELECT case_cin FROM emrs_d_case csi where csi.case_number = pl.case_id and current_flag = 'Y') case_cin
from D_PL_CURRENT pl 
 inner join d_letter_definition ld
   on pl.letter_definition_id = ld.lmdef_id
 left outer join (SELECT DISTINCT csda_name,csda_code,managed_care_program, dc.county_code
    FROM emrs_d_county dc
    INNER JOIN emrs_d_care_serv_deliv_area da
      ON dc.csdaid = da.csda_code
    WHERE da.csda_code != 'DENTAL') sa
    on sa.managed_care_program = COALESCE(ld.letter_program,'MEDICAID')
    AND sa.county_code = pl.county_code
with read only;