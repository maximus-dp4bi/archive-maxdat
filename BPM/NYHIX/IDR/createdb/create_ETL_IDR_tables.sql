/*
Created on 11-Sep-2013 by Raj A.
Team: MAXDAT.
Business Process: NYHIX IDR Incidents.

Description:
Three stage tables are created for this process.
1.nyhx_etl_IDR_Incidents
2.nyhx_etl_IDR_Incidents_oltp
3.nyhx_etl_IDR_Incidents_wip
*/
create table NYHX_ETL_IDR_INCIDENTS
(
NEII_ID                NUMBER(18),
INCIDENT_ID            NUMBER(18),
CREATED_BY_GROUP       VARCHAR2(80),
CREATED_BY_NAME        VARCHAR2(150),
TRACKING_NUMBER        VARCHAR2(32),
CREATE_DT              DATE,
INCIDENT_TYPE          VARCHAR2(80),
CLIENT_ID              NUMBER(18),
ASSD_IDR_REVIEW_DOCS   DATE,
ASED_IDR_REVIEW_DOCS   DATE,
ASPB_IDR_REVIEW_DOCS   VARCHAR2(150),
ASSD_GATHER_MISS_INFO  DATE,
ASED_GATHER_MISS_INFO  DATE,
ASPB_GATHER_MISS_INFO  VARCHAR2(150),
ABOUT_PLAN_CODE        VARCHAR2(32), --PLANS.PLAN_CODE
ABOUT_PROVIDER_ID      NUMBER(18), --NETWORK.PROVIDER_ID
ACTION_COMMENTS        VARCHAR2(4000),  ------INCIDENT_HEADER.Actions_taken is a CLOB.
ACTION_TYPE            VARCHAR2(64), --ENUM_ACTION_TAKEN.REPORT_LABEL
CANCEL_BY              VARCHAR2(150), --Staff.last_name||first name||middle name
CANCEL_DT              DATE,
CANCEL_METHOD          VARCHAR2(30),
CANCEL_REASON          VARCHAR2(50), --no rule in WB, so null.
CURRENT_TASK_ID        NUMBER(38),
ENROLLMENT_STATUS      VARCHAR2(50),
INCIDENT_ABOUT         VARCHAR2(80),   --ENUM_AFFECTED_PARTY_TYPE.report_label
INCIDENT_DESCRIPTION   VARCHAR2(4000), ------INCIDENT_ISSUE.DESCRIPTION is a CLOB
INCIDENT_STATUS        VARCHAR2(80),
INCIDENT_STATUS_DT     DATE,
INSTANCE_COMPLETE_DT   DATE,
COMPLETE_DT            date,
INSTANCE_STATUS        VARCHAR2(10) default 'Active' not null,
LAST_UPDATE_BY_NAME    VARCHAR2(150), --Staff.last_name||first name||middle name
LAST_UPDATE_BY_DT      DATE,
UPDATED_BY             VARCHAR2(80), --INCIDENT_HEADER.UPDATED_BY
OTHER_PARTY_NAME       VARCHAR2(64), --ENUM_OTHER_PARTY_TYPE.REPORT_LABEL
PRIORITY               VARCHAR2(64), --ENUM_PRIORITY.REPORT_LABEL
REPORTED_BY            VARCHAR2(80), --ENUM_REPORTER_TYPE.REPORT_LABEL
REPORTER_RELATIONSHIP  VARCHAR2(64), --REPORTER_RELATIONSHIP
RESOLUTION_DESCRIPTION VARCHAR2(4000),------INCIDENT_HEADER.resolution is a CLOB.
RESOLUTION_TYPE        VARCHAR2(64), --RESOLUTION_TYPE_CD
CASE_ID                NUMBER(38),
FORWARDED              VARCHAR2(1) default 'N' not null,  --Y or N field
FORWARDED_TO           VARCHAR2(30), --INCIDENT_HEADER_STAT_HIST.Status_CD Hierarchy; Values tab
ASF_IDR_REVIEW_DOCS    VARCHAR2(1) default 'N' not null,
ASF_GATHER_MISS_INFO   VARCHAR2(1) default 'N' not null,
GWF_CONTINUE_APPEAL    VARCHAR2(1),
STG_EXTRACT_DATE       DATE not null,
STG_LAST_UPDATE_DATE   DATE  not null,
STAGE_DONE_DATE        DATE,
MAX_INCI_STAT_HIST_ID NUMBER(38),
CURRENT_STEP          VARCHAR2(256),
APPELLANT_TYPE VARCHAR2(32),     
APPELLANT_TYPE_DESC VARCHAR2(64),
REPORTER_NAME       VARCHAR2(180),
REPORTER_PHONE      VARCHAR2(32),
CHANNEL 	    VARCHAR2(80),
ACCOUNT_ID		VARCHAR2(30)
) TABLESPACE MAXDAT_DATA PARALLEL;

alter table NYHX_ETL_IDR_INCIDENTS
  add constraint IDR_PK primary key (NEII_ID) using index tablespace MAXDAT_INDX;

alter table NYHX_ETL_IDR_INCIDENTS
  add constraint IDR_UK unique (INCIDENT_ID) using index tablespace MAXDAT_INDX;  

alter table NYHX_ETL_IDR_INCIDENTS
  add constraint NYHX_ETL_IDR_INCIDENTS_C1
  check (ASF_IDR_REVIEW_DOCS IN ('Y','N'));

alter table NYHX_ETL_IDR_INCIDENTS
  add constraint NYHX_ETL_IDR_INCIDENTS_C2
  check (ASF_GATHER_MISS_INFO IN ('Y','N'));
  
alter table NYHX_ETL_IDR_INCIDENTS modify INCIDENT_ID        not null;
--alter table NYHX_ETL_IDR_INCIDENTS modify CREATED_BY_GROUP   null;
alter table NYHX_ETL_IDR_INCIDENTS modify CREATED_BY_NAME    not null;
alter table NYHX_ETL_IDR_INCIDENTS modify TRACKING_NUMBER    not null;
alter table NYHX_ETL_IDR_INCIDENTS modify CREATE_DT          not null;
alter table NYHX_ETL_IDR_INCIDENTS modify INCIDENT_TYPE      not null;
alter table NYHX_ETL_IDR_INCIDENTS modify INCIDENT_STATUS    not null;
alter table NYHX_ETL_IDR_INCIDENTS modify INCIDENT_STATUS_DT not null;
--alter table NYHX_ETL_IDR_INCIDENTS modify LAST_UPDATE_BY_DT  null; 

--GRANTS
grant select on NYHX_ETL_IDR_INCIDENTS to MAXDAT_READ_ONLY;
 

create table NYHX_ETL_IDR_INCIDENTS_oltp
(
NEII_ID                NUMBER(18),
INCIDENT_ID            NUMBER(18),
CREATED_BY_GROUP       VARCHAR2(80),
CREATED_BY_NAME        VARCHAR2(150),
TRACKING_NUMBER        VARCHAR2(32),
CREATE_DT              DATE,
INCIDENT_TYPE          VARCHAR2(80),
CLIENT_ID              NUMBER(18),
ASSD_IDR_REVIEW_DOCS   DATE,
ASED_IDR_REVIEW_DOCS   DATE,
ASPB_IDR_REVIEW_DOCS   VARCHAR2(150),
ASSD_GATHER_MISS_INFO  DATE,
ASED_GATHER_MISS_INFO  DATE,
ASPB_GATHER_MISS_INFO  VARCHAR2(150),
ABOUT_PLAN_CODE        VARCHAR2(32), --PLANS.PLAN_CODE
ABOUT_PROVIDER_ID      NUMBER(18), --NETWORK.PROVIDER_ID
ACTION_COMMENTS        VARCHAR2(4000), 
ACTION_TYPE            VARCHAR2(64), --ENUM_ACTION_TAKEN.REPORT_LABEL
CANCEL_BY              VARCHAR2(150), --Staff.last_name||first name||middle name
CANCEL_DT              DATE,
CANCEL_METHOD          VARCHAR2(30),
CANCEL_REASON          VARCHAR2(50), --no rule in WB, so null.
CURRENT_TASK_ID        NUMBER(38),
ENROLLMENT_STATUS      VARCHAR2(50),
INCIDENT_ABOUT         VARCHAR2(80),   --ENUM_AFFECTED_PARTY_TYPE.report_label
INCIDENT_DESCRIPTION   VARCHAR2(4000), --INCIDENT_ISSUE.DESCRIPTION
INCIDENT_STATUS        VARCHAR2(80),
INCIDENT_STATUS_DT     DATE,
INSTANCE_COMPLETE_DT   DATE,
COMPLETE_DT            date,
INSTANCE_STATUS        VARCHAR2(10) default 'Active' not null,
LAST_UPDATE_BY_NAME    VARCHAR2(150), --Staff.last_name||first name||middle name
LAST_UPDATE_BY_DT      DATE,
UPDATED_BY             VARCHAR2(80), --INCIDENT_HEADER.UPDATED_BY
OTHER_PARTY_NAME       VARCHAR2(64), --ENUM_OTHER_PARTY_TYPE.REPORT_LABEL
PRIORITY               VARCHAR2(64), --ENUM_PRIORITY.REPORT_LABEL
REPORTED_BY            VARCHAR2(80), --ENUM_REPORTER_TYPE.REPORT_LABEL
REPORTER_RELATIONSHIP  VARCHAR2(64), --REPORTER_RELATIONSHIP
RESOLUTION_DESCRIPTION VARCHAR2(4000),
RESOLUTION_TYPE        VARCHAR2(64), --RESOLUTION_TYPE_CD
CASE_ID                NUMBER(38),
FORWARDED              VARCHAR2(1) default 'N' not null,  --Y or N field
FORWARDED_TO           VARCHAR2(30), --INCIDENT_HEADER_STAT_HIST.Status_CD Hierarchy; Values tab
ASF_IDR_REVIEW_DOCS    VARCHAR2(1),
ASF_GATHER_MISS_INFO   VARCHAR2(1),
GWF_CONTINUE_APPEAL    VARCHAR2(1),
STG_EXTRACT_DATE       DATE not null,
STG_LAST_UPDATE_DATE   DATE  not null,
STAGE_DONE_DATE        DATE,
MAX_INCI_STAT_HIST_ID  NUMBER(38),
INCIDENT_HEADER_STATUS_ID NUMBER(18),
CURRENT_STEP           VARCHAR2(256),
APPELLANT_TYPE VARCHAR2(32),     
APPELLANT_TYPE_DESC VARCHAR2(64),
REPORTER_NAME       VARCHAR2(180),
REPORTER_PHONE      VARCHAR2(32),
CHANNEL 	    VARCHAR2(80),
ACCOUNT_ID		VARCHAR2(30)
) TABLESPACE MAXDAT_DATA PARALLEL; 

--GRANTS
grant select on NYHX_ETL_IDR_INCIDENTS_oltp to MAXDAT_READ_ONLY; 


create table NYHX_ETL_IDR_INCIDENTS_wip
(
NEII_ID                NUMBER(18),
INCIDENT_ID            NUMBER(18),
CREATED_BY_GROUP       VARCHAR2(80),
CREATED_BY_NAME        VARCHAR2(150),
TRACKING_NUMBER        VARCHAR2(32),
CREATE_DT              DATE,
INCIDENT_TYPE          VARCHAR2(80),
CLIENT_ID              NUMBER(18),
ASSD_IDR_REVIEW_DOCS   DATE,
ASED_IDR_REVIEW_DOCS   DATE,
ASPB_IDR_REVIEW_DOCS   VARCHAR2(150),
ASSD_GATHER_MISS_INFO  DATE,
ASED_GATHER_MISS_INFO  DATE,
ASPB_GATHER_MISS_INFO  VARCHAR2(150),
ABOUT_PLAN_CODE        VARCHAR2(32), --PLANS.PLAN_CODE
ABOUT_PROVIDER_ID      NUMBER(18), --NETWORK.PROVIDER_ID
ACTION_COMMENTS        VARCHAR2(4000), 
ACTION_TYPE            VARCHAR2(64), --ENUM_ACTION_TAKEN.REPORT_LABEL
CANCEL_BY              VARCHAR2(150), --Staff.last_name||first name||middle name
CANCEL_DT              DATE,
CANCEL_METHOD          VARCHAR2(30),
CANCEL_REASON          VARCHAR2(50), --no rule in WB, so null.
CURRENT_TASK_ID        NUMBER(38),
ENROLLMENT_STATUS      VARCHAR2(50),
INCIDENT_ABOUT         VARCHAR2(80),   --ENUM_AFFECTED_PARTY_TYPE.report_label
INCIDENT_DESCRIPTION   VARCHAR2(4000), --INCIDENT_ISSUE.DESCRIPTION
INCIDENT_STATUS        VARCHAR2(80),
INCIDENT_STATUS_DT     DATE,
INSTANCE_COMPLETE_DT   DATE,
COMPLETE_DT            date,
INSTANCE_STATUS        VARCHAR2(10) default 'Active' not null,
LAST_UPDATE_BY_NAME    VARCHAR2(150), --Staff.last_name||first name||middle name
LAST_UPDATE_BY_DT      DATE,
UPDATED_BY             VARCHAR2(80), --INCIDENT_HEADER.UPDATED_BY
OTHER_PARTY_NAME       VARCHAR2(64), --ENUM_OTHER_PARTY_TYPE.REPORT_LABEL
PRIORITY               VARCHAR2(64), --ENUM_PRIORITY.REPORT_LABEL
REPORTED_BY            VARCHAR2(80), --ENUM_REPORTER_TYPE.REPORT_LABEL
REPORTER_RELATIONSHIP  VARCHAR2(64), --REPORTER_RELATIONSHIP
RESOLUTION_DESCRIPTION VARCHAR2(4000),
RESOLUTION_TYPE        VARCHAR2(64), --RESOLUTION_TYPE_CD
CASE_ID                NUMBER(38),
FORWARDED              VARCHAR2(1)  default 'N' not null,  --Y or N field
FORWARDED_TO           VARCHAR2(30), --INCIDENT_HEADER_STAT_HIST.Status_CD Hierarchy; Values tab
ASF_IDR_REVIEW_DOCS    VARCHAR2(1),
ASF_GATHER_MISS_INFO   VARCHAR2(1),
GWF_CONTINUE_APPEAL    VARCHAR2(1),
STG_EXTRACT_DATE       DATE not null,
STG_LAST_UPDATE_DATE   DATE  not null,
STAGE_DONE_DATE        DATE,
MAX_INCI_STAT_HIST_ID  NUMBER(38),
UPDATED_FLG            varchar2(1),
CURRENT_STEP           VARCHAR2(256),
APPELLANT_TYPE VARCHAR2(32),     
APPELLANT_TYPE_DESC VARCHAR2(64),
REPORTER_NAME       VARCHAR2(180),
REPORTER_PHONE      VARCHAR2(32),
CHANNEL 	    VARCHAR2(80),
ACCOUNT_ID		VARCHAR2(30)
) TABLESPACE MAXDAT_DATA PARALLEL;

--GRANTS
grant select on NYHX_ETL_IDR_INCIDENTS_wip to MAXDAT_READ_ONLY;


create table IDR_forwarding_Hierarchy
(
forwarding_level              number(5),
Corresponding_Incident_status varchar2(30),
Corresponding_Inci_stat_desc  VARCHAR2(128)
) TABLESPACE MAXDAT_DATA PARALLEL;

--GRANTS
grant select on IDR_forwarding_Hierarchy to MAXDAT_READ_ONLY;


CREATE TABLE IDR_timeliness_jeopardy
(
row_ID          number,
Incident_type   VARCHAR2(80),
incident_about  VARCHAR2(80),
incident_reason VARCHAR2(80),
sla_days_type   VARCHAR2(1),
target_days     number(18),
jeopardy_days   number(18)
) TABLESPACE MAXDAT_DATA PARALLEL;

--GRANTS
grant select on IDR_timeliness_jeopardy to MAXDAT_READ_ONLY;


CREATE TABLE NYHX_ETL_IDR_INCIDENT_RSN
(NEIIR_ID NUMBER NOT NULL ENABLE,
 INCIDENT_ID NUMBER(18,0) NOT NULL ENABLE,     
 INCIDENT_REASON VARCHAR2(80)
 ) TABLESPACE MAXDAT_DATA PARALLEL;

--CREATE PRIMARY KEY
alter table  NYHX_ETL_IDR_INCIDENT_RSN add primary key (NEIIR_ID) using index tablespace MAXDAT_INDX;    

--CREATE FOREIGN KEY
ALTER TABLE NYHX_ETL_IDR_INCIDENT_RSN ADD CONSTRAINT NYHX_ETL_IDR_INCI_RSN_FK FOREIGN KEY(NEII_ID) REFERENCES NYHX_ETL_IDR_INCIDENTS(NEII_ID) ENABLE;

--GRANTS
Grant select on NYHX_ETL_IDR_INCIDENT_RSN to MAXDAT_READ_ONLY;