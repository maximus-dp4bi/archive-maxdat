declare  c int;
begin
   select count(*) into c from user_tables where table_name ='ENGAGE_ACTUALS_QC_EVAL';
   if c = 1 then
      execute immediate 'drop table ENGAGE_ACTUALS_QC_EVAL cascade constraints';
   end if;
end;
/

CREATE TABLE ENGAGE_ACTUALS_QC_EVAL
	(
	  EVALUATION_REFERENCE_ID NUMBER
	, EVALUATION_REFERENCE    VARCHAR2 (512)
	, AGENT_ID                VARCHAR2 (250)
	, EVALUATOR_ID            VARCHAR2 (250)
	, SCORE_TOTAL             NUMBER
	, EVALUATION_DATE_TIME    DATE
	, EVALUATION_FORM         VARCHAR2 (512)
	, CREATE_BY               VARCHAR2 (100)
	, CREATE_DATETIME         DATE
	, LAST_UPDATE_DATE        DATE
	, LAST_UPDATED_BY         VARCHAR2 (100)
	)
	TABLESPACE MAXDAT_DATA;

CREATE INDEX ENGAGEACTQCEVAL_EVALDT
	ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL (EVALUATION_DATE_TIME)
	TABLESPACE MAXDAT_INDX;

CREATE INDEX ENGAGEACTQCEVAL_EVALFORM
	ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL (EVALUATION_FORM)
	TABLESPACE MAXDAT_INDX;

CREATE INDEX ENGAGEACTQCEVAL_EVALREF
	ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL (EVALUATION_REFERENCE)
	TABLESPACE MAXDAT_INDX;

CREATE UNIQUE INDEX ENGAGEACTQCEVAL_EVALREF_ID
	ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL (EVALUATION_REFERENCE_ID)
	TABLESPACE MAXDAT_INDX;



GRANT DELETE ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL TO MAXDAT;
GRANT INSERT ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL TO MAXDAT;
GRANT SELECT ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL TO MAXDAT;
GRANT UPDATE ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL TO MAXDAT;
GRANT SELECT ON DP_SCORECARD.ENGAGE_ACTUALS_QC_EVAL TO MAXDAT_READ_ONLY;

CREATE OR REPLACE VIEW ENGAGE_ACTUALS_QC_EVAL_SV
AS
select 
evaluation_reference_id
 ,evaluation_reference
 ,agent_id
 ,evaluator_id
 ,score_total
 ,evaluation_date_time 
 ,evaluation_form
 ,create_by
 ,create_datetime
 ,last_update_date 
 ,last_updated_by
from ENGAGE_ACTUALS_QC_EVAL
WITH READ ONLY;

GRANT SELECT ON ENGAGE_ACTUALS_QC_EVAL_SV TO MAXDAT;
GRANT SELECT ON ENGAGE_ACTUALS_QC_EVAL_SV TO MAXDAT_READ_ONLY;

CREATE OR REPLACE TRIGGER TRG_BIU_ENGAGE_ACTUALS_QC_EVAL
BEFORE INSERT OR UPDATE ON ENGAGE_ACTUALS_QC_EVAL
FOR EACH ROW

BEGIN
  IF INSERTING THEN
    :new.create_by := user;
    :new.create_datetime := sysdate;
  END IF;

 :new.last_updated_by := user;
 :new.last_update_date := sysdate;

end;
/


