CREATE OR REPLACE PROCEDURE DP_SCORECARD.LOAD_SC_SUMMARY_CC_ROLLUP
AS
-- Do not edit these four SVN_* variable values.  They are populated when you commit code to SVN and used later to identify deployed code.
 	SVN_FILE_URL varchar2(200) := '$URL: svn://rcmxapp1d.maximus.com/maxdat/BPM/NYHIX/patch/20170623_PP_WFM_BACK_OFFICE_LOAD_PKG.sql $'; 
  	SVN_REVISION varchar2(20) := '$Revision: 20489 $'; 
 	SVN_REVISION_DATE varchar2(60) := '$Date: 2017-07-03 14:31:06 -0500 (Mon, 03 Jul 2017) $'; 
  	SVN_REVISION_AUTHOR varchar2(20) := '$Author: wl134672 $';


begin

  execute immediate 'TRUNCATE TABLE DP_SCORECARD.SC_SUMMARY_CC_ROLLUP';
    --Delete from DP_SCORECARD.SC_SUMMARY_CC_ROLLUP;
    --commit;
   
INSERT INTO DP_SCORECARD.SC_SUMMARY_CC_ROLLUP
	( SUPERVISOR_STAFF_ID, DATES_MONTH, DATES_MONTH_NUM, 
	DATES_YEAR, EXCLUSION_FLAG, 
   	BUILDING,
	DEPARTMENT,
	TOT_CALLS_ANSWERED, 
   TOT_SHORT_CALLS_ANSWERED, TOT_TOT_RETURN_TO_QUEUE, TOT_AVERAGE_HANDLE_TIME, 
   TOT_SCHED_PRODUCTIVE_TIME, TOT_ACTUAL_PRODUCTIVE_TIME, TOT_TALK_TIME, 
   TOT_WRAP_UP_TIME, TOT_LOGGED_IN_TIME, TOT_NOT_READY_TIME, 
   TOT_BREAK_TIME, TOT_LUNCH_TIME, QCS_PERFORMED, 
   AVG_QC_SCORE, TOT_INCIDENTS_COMPLETED, DAYS_INCIDENTS_COMPLETED, 
   TOT_DEFECTS_COMPLETED, DAYS_DEFECTS_COMPLETED, LAG_TIME_TOT_SCHED_PROD_TIME, 
   TOT_CALL_RECORDS, TOT_CUSTOMER_COUNT, TOT_CALL_WRAP_UP_COUNT, 
   TOT_WRAP_UP_ERROR, DAYS_SHORT_CALLS_GT_10, DAYS_CALLS_ANSWERED, 
   ADHERENCE, TOT_RETURN_TO_QUEUE_TIMEOUT, AVG_ATTENDANCE_BALANCE, 
   AVG_ATTENDANCE_TOTAL_BALANCE, STAFF_COUNT, SUM_QC_SCORE, 
   COUNT_QC_SCORE, QCS_REMAINING, TOT_HANDLE_TIME, 
   TOT_HANDLE_TIME_COUNT, STAFF_TRTQ_COUNT, SHORT_CALL_AGENT_COUNT
   )
-----
SELECT 
	SUPERVISOR_STAFF_ID, 
	DATES_MONTH, 
	DATES_MONTH_NUM, 
	DATES_YEAR, 
	EXCLUSION_FLAG, 
	BUILDING,
	DEPARTMENT,
	SUM(NVL(TOT_CALLS_ANSWERED,0)) 							AS 	TOT_CALLS_ANSWERED, 
	SUM(NVL(TOT_SHORT_CALLS_ANSWERED,0)) 					AS 	TOT_SHORT_CALLS_ANSWERED, 
	SUM(NVL(TOT_TOT_RETURN_TO_QUEUE,0)) 					AS 	TOT_TOT_RETURN_TO_QUEUE, 
	SUM(NVL(TOT_AVERAGE_HANDLE_TIME,0)) 					AS 	TOT_AVERAGE_HANDLE_TIME, 
	SUM(NVL(TOT_SCHED_PRODUCTIVE_TIME,0)) 					AS 	TOT_SCHED_PRODUCTIVE_TIME, 
	SUM(NVL(TOT_ACTUAL_PRODUCTIVE_TIME,0)) 					AS 	TOT_ACTUAL_PRODUCTIVE_TIME, 
	SUM(NVL(TOT_TALK_TIME,0)) 								AS 	TOT_TALK_TIME, 
	SUM(NVL(TOT_WRAP_UP_TIME,0)) 							AS 	TOT_WRAP_UP_TIME, 
	SUM(NVL(TOT_LOGGED_IN_TIME,0)) 							AS 	TOT_LOGGED_IN_TIME, 
	SUM(NVL(TOT_NOT_READY_TIME,0)) 							AS 	TOT_NOT_READY_TIME, 
	SUM(NVL(TOT_BREAK_TIME,0)) 								AS 	TOT_BREAK_TIME, 
	SUM(NVL(TOT_LUNCH_TIME,0)) 								AS 	TOT_LUNCH_TIME, 
	SUM(NVL(QCS_PERFORMED,0)) 								AS 	QCS_PERFORMED, 
	SUM(NVL(AVG_QC_SCORE,0)) 								AS 	AVG_QC_SCORE, 
	SUM(NVL(TOT_INCIDENTS_COMPLETED,0)) 					AS 	TOT_INCIDENTS_COMPLETED, 
	SUM(NVL(DAYS_INCIDENTS_COMPLETED,0)) 					AS 	DAYS_INCIDENTS_COMPLETED, 
	SUM(NVL(TOT_DEFECTS_COMPLETED,0)) 						AS 	TOT_DEFECTS_COMPLETED, 
	SUM(NVL(DAYS_DEFECTS_COMPLETED,0)) 						AS 	DAYS_DEFECTS_COMPLETED, 
	SUM(NVL(LAG_TIME_TOT_SCHED_PROD_TIME,0))				AS 	LAG_TIME_TOT_SCHED_PROD_TIME, 
	SUM(NVL(TOT_CALL_RECORDS,0)) 							AS 	TOT_CALL_RECORDS, 
	SUM(NVL(TOT_CUSTOMER_COUNT,0)) 							AS 	TOT_CUSTOMER_COUNT, 
	SUM(NVL(TOT_CALL_WRAP_UP_COUNT,0)) 						AS 	TOT_CALL_WRAP_UP_COUNT, 
	SUM(NVL(TOT_WRAP_UP_ERROR,0)) 							AS 	TOT_WRAP_UP_ERROR, 
	SUM(NVL(DAYS_SHORT_CALLS_GT_10,0)) 						AS 	DAYS_SHORT_CALLS_GT_10, 
	SUM(NVL(DAYS_CALLS_ANSWERED,0)) 						AS 	DAYS_CALLS_ANSWERED, 
--	SUM(NVL(ADHERENCE,0)) 									AS 	ADHERENCE, 
    SUM(TOT_LOGGED_IN_TIME - TOT_NOT_READY_TIME)/SUM(LAG_TIME_TOT_SCHED_PROD_TIME)          AS ADHERENCE,	
    SUM(NVL(TOT_RETURN_TO_QUEUE_TIMEOUT,0)) 				AS 	TOT_RETURN_TO_QUEUE_TIMEOUT, 
	SUM(NVL(AVG_ATTENDANCE_BALANCE,0)) 						AS 	AVG_ATTENDANCE_BALANCE, 
	SUM(NVL(AVG_ATTENDANCE_TOTAL_BALANCE,0))				AS 	AVG_ATTENDANCE_TOTAL_BALANCE, 
	SUM(NVL(STAFF_COUNT,0)) 								AS 	STAFF_COUNT, 
	SUM(NVL(SUM_QC_SCORE,0)) 								AS 	SUM_QC_SCORE, 
	SUM(NVL(COUNT_QC_SCORE,0)) 								AS 	COUNT_QC_SCORE, 
	SUM(NVL(QCS_REMAINING,0)) 								AS 	QCS_REMAINING, 
	SUM(NVL(TOT_HANDLE_TIME,0)) 							AS 	TOT_HANDLE_TIME, 
	SUM(NVL(TOT_HANDLE_TIME_COUNT,0)) 						AS 	TOT_HANDLE_TIME_COUNT, 
	SUM(NVL(TRTQ,0))               							AS STAFF_TRTQ_COUNT , 			
	SUM(NVL(SHORT_CALL_AGENT_COUNT,0))						AS 	SHORT_CALL_AGENT_COUNT
FROM DP_SCORECARD.SC_SUMMARY_CC
GROUP BY
	SUPERVISOR_STAFF_ID, 
	DATES_MONTH, 
	DATES_MONTH_NUM, 
	DATES_YEAR, 
	EXCLUSION_FLAG, 
	BUILDING,
	DEPARTMENT;
	
COMMIT;	

end LOAD_SC_SUMMARY_CC_ROLLUP;
/

GRANT DEBUG ON DP_SCORECARD.LOAD_SC_SUMMARY_CC TO MAXDAT_READ_ONLY;

GRANT DEBUG ON DP_SCORECARD.LOAD_SC_SUMMARY_CC TO DP_SCORECARD_READ_ONLY;
