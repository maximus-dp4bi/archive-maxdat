---  DP_SCORECARD.SCORECARD_QUALITY_TL_SV
---  NYHIX-26691 - NYSOH - Scorecard - Phase II - ISSUE - Quality Tab / Audit specific displayed 
DROP VIEW "DP_SCORECARD"."SCORECARD_QUALITY_TL_SV";

CREATE OR REPLACE VIEW DP_SCORECARD.SCORECARD_QUALITY_TL_SV AS
with QUALITY AS
(
SELECT DISTINCT A.EVALUATOR_ID,
Case when (A.CALL_DATE is null or A.CALL_DATE = to_date('1/1/1753','mm/dd/yyyy')) then A.EVALUATION_DATE_TIME else A.CALL_DATE end as EVALUATION_DATE_TIME,
F.SCORECARD_SCORE_TYPE,
F.SCORECARD_GROUP,
A.EVALUATION_REFERENCE,
A.SCORE_TOTAL,
A.AGENT_ID AS Evaluatee_EID,
(LAST_NAME || ', ' || FIRST_NAME) as Evaluatee
FROM DP_SCORECARD.ENGAGE_ACTUALS_SV A
JOIN DP_SCORECARD.ENGAGE_FORM_TYPE F
ON A.EVALUATION_FORM = F.EVALUATION_FORM
JOIN MAXDAT.PP_WFM_STAFF S
ON A.AGENT_ID = S.NATIONAL_ID
WHERE F.SCORECARD_SCORE_TYPE = 'QC'
)
SELECT distinct S.staff_staff_id,
S.staff_staff_name,
S.staff_natid,
E.Evaluatee_EID,
E.Evaluatee,
E.SCORECARD_SCORE_TYPE,
E.SCORE_TOTAL,
E.EVALUATION_DATE_TIME as EVAL_DATE,
E.EVALUATION_REFERENCE
FROM dp_scorecard.scorecard_hierarchy_sv S
JOIN QUALITY E ON S.staff_natid = E.EVALUATOR_ID;
GRANT select on DP_SCORECARD.SCORECARD_QUALITY_TL_SV to MAXDAT_READ_ONLY;
GRANT select on DP_SCORECARD.SCORECARD_QUALITY_TL_SV to MAXDAT;
