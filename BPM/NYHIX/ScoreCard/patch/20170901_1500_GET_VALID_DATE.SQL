---------------------------------------------------------------
-- CHANGES NEEDED FOR SECONDARY_ID
---------------------------------------------------------------

CREATE OR REPLACE function MAXDAT.GET_VALID_DATE( date_string in varchar, pattern_string in varchar2 default 'mm/dd/yyyy' )
return date
is
    good_date date;
begin
   good_date := to_date(date_string,pattern_string);
   return good_date;
exception
    when others then
    return to_date(null);
end;
/

grant execute on MAXDAT.GET_VALID_DATE to DP_SCORECARD;

DROP VIEW MAXDAT.PP_WFM_STAFF_SV;

CREATE OR REPLACE FORCE VIEW MAXDAT.PP_WFM_STAFF_SV
(STAFF_ID, NATIONAL_ID, LAST_NAME, FIRST_NAME, MIDDLE_NAME, 
 SUFFIX, HIRE_DATE, TERMINATION_DATE, SCHEDULE_TYPE, DELETE_DATE, 
 SENIORITY_EFFECTIVE_DATE, OWNER_USER, MODIFY_USER, OWNER_DATE, MODIFY_DATE, 
 EMAIL_ADDRESS, COMMAND_SCRIPT, MESSAGE_BUFFER, SECONDARY_ID, ADDRESS, 
 WORK_PHONE, HOME_PHONE, TERMINATION_POLICY_ID, TERMINATION_REASON, PIP_ADDRESS, 
 TEXT_ADDRESS, CELL_PHONE, EXTRACT_DT, LAST_UPDATE_DT, LAST_UPDATED_BY)
AS 
SELECT STAFF_ID
,NATIONAL_ID
,LAST_NAME
,FIRST_NAME
,MIDDLE_NAME
,SUFFIX
,HIRE_DATE
,TERMINATION_DATE
,SCHEDULE_TYPE
,DELETE_DATE
,SENIORITY_EFFECTIVE_DATE
,OWNER_USER
,MODIFY_USER
,OWNER_DATE
,MODIFY_DATE
,EMAIL_ADDRESS
,COMMAND_SCRIPT
,MESSAGE_BUFFER
--,TO_DATE(SECONDARY_ID,'mm/dd/yyyy') secondary_id
,MAXDAT.get_valid_date(SECONDARY_ID) secondary_id
,ADDRESS
,WORK_PHONE
,HOME_PHONE
,TERMINATION_POLICY_ID
,TERMINATION_REASON
,PIP_ADDRESS
,TEXT_ADDRESS
,CELL_PHONE
,EXTRACT_DT
,LAST_UPDATE_DT
,LAST_UPDATED_BY
FROM PP_WFM_STAFF
--WHERE regexp_like(SECONDARY_ID,'^[0-1]?[0-9]/[0-3]?[0-9]/20[0123][0-9]')
WITH READ ONLY;

GRANT SELECT ON MAXDAT.PP_WFM_STAFF_SV TO MAXDAT_READ_ONLY;

GRANT SELECT ON MAXDAT.PP_WFM_STAFF_SV TO DP_SCORECARD;

GRANT SELECT ON MAXDAT.PP_WFM_STAFF_SV TO MAXDAT_REPORTS;
 
----------------------------------------
-- CHANGES NEEDED FOR STAFF_ELIGIBILITY
----------------------------------------
GRANT SELECT ON MAXDAT.PP_WFM_EVENT TO DP_SCORECARD WITH GRANT OPTION;

GRANT SELECT ON MAXDAT.PP_WFM_EVENT_SV TO DP_SCORECARD;

