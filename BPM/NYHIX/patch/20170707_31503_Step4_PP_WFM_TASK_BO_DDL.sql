
SELECT COUNT(*) FROM DP_SCORECARD.PP_WFM_TASK_BO;

SELECT COUNT(*) FROM DP_SCORECARD.PP_WFM_TASK_BO_NEW;
	

--------------------------------------------------
-- RENAME THE CURRENT TABLE TO PP_WFM_TASK_BO_BAK
--------------------------------------------------
	
RENAME PP_WFM_TASK_BO TO PP_WFM_TASK_BO_BAK;

GRANT SELECT ON DP_SCORECARD.PP_WFM_TASK_BO_BAK TO MAXDAT;

GRANT SELECT ON DP_SCORECARD.PP_WFM_TASK_BO_BAK TO DP_SCORECARD_READ_ONLY;

GRANT SELECT ON DP_SCORECARD.PP_WFM_TASK_BO_BAK TO MAXDAT_READ_ONLY;


---------------------------------------------------
-- DROP THE INDEXES
--------------------------------------------------

ALTER TABLE PP_WFM_TASK_BO_BAK
DROP CONSTRAINT PP_WFM_TASK_BO_PK; 

DROP INDEX BO_TASK_TASK_ID_IDX;

DROP INDEX BO_TASK_STAFF_ID_IDX;

DROP INDEX BO_TASK_EVENT_ID_IDX;

DROP INDEX BO_TASK_TASK_CATEGORY_ID_IDX;

---------------------------------------------------
-- RENAME THE NEW TABLE TO THE OLD NAME
---------------------------------------------------

RENAME PP_WFM_TASK_BO_NEW TO PP_WFM_TASK_BO;

GRANT SELECT ON DP_SCORECARD.PP_WFM_TASK_BO TO MAXDAT;

GRANT SELECT ON DP_SCORECARD.PP_WFM_TASK_BO TO DP_SCORECARD_READ_ONLY;

GRANT SELECT ON DP_SCORECARD.PP_WFM_TASK_BO TO MAXDAT_READ_ONLY;


---------------------------------------------------
-- RECREATE THE INDEXES ON THE NEW TABLE
---------------------------------------------------
	
CREATE UNIQUE INDEX PP_WFM_TASK_BO_NEW_PK
	ON DP_SCORECARD.PP_WFM_TASK_BO (PP_WFM_TASK_BO_ID)
	TABLESPACE MAXDAT_INDX;

ALTER TABLE DP_SCORECARD.PP_WFM_TASK_BO
ADD CONSTRAINT PP_WFM_TASK_BO_PK 
PRIMARY KEY (PP_WFM_TASK_BO_ID);

CREATE INDEX BO_TASK_EVENT_ID_IDX
	ON DP_SCORECARD.PP_WFM_TASK_BO (EVENT_ID)
	TABLESPACE MAXDAT_INDX;

CREATE INDEX BO_TASK_STAFF_ID_IDX
	ON DP_SCORECARD.PP_WFM_TASK_BO (STAFF_ID);

CREATE INDEX BO_TASK_TASK_CAT_ID_IDX
	ON DP_SCORECARD.PP_WFM_TASK_BO (TASK_CATEGORY_ID)
	TABLESPACE MAXDAT_INDX;

CREATE INDEX BO_TASK_TASK_ID_IDX
	ON DP_SCORECARD.PP_WFM_TASK_BO (TASK_ID)
	TABLESPACE MAXDAT_INDX;

-----------------------------------------------------
-- POINT THE TRIGGER TO THE NEW TABLE
-----------------------------------------------------

DROP TRIGGER BIU_PP_WFM_TASK_BO;

CREATE OR REPLACE TRIGGER BIU_PP_WFM_TASK_BO
    BEFORE INSERT OR UPDATE ON "PP_WFM_TASK_BO"
    FOR EACH ROW
BEGIN
IF INSERTING AND :NEW.PP_WFM_TASK_BO_ID IS NULL THEN 
          SELECT SEQ_PP_WFM_TASK_BO_ID.NEXTVAL INTO :NEW.PP_WFM_TASK_BO_ID FROM DUAL;
END IF;
IF INSERTING THEN 
          :NEW.EXTRACT_DT := SYSDATE;
END IF;
:NEW.LAST_UPDATE_DT := SYSDATE;
:NEW.LAST_UPDATED_BY := USER;
END;
/

----------------------------------------------------------
-- RECOMPLIE ANY INVALID OBJECTS
-- THE FOLLOWING WILL PRODUCE THE SQL FOR THE RECOMPILE
----------------------------------------------------------


select 'ALTER '||OBJECT_TYPE||' '||OBJECT_NAME||' COMPILE;' from all_objects 
where status <> 'VALID'
AND OWNER = 'DP_SCORECARD';



