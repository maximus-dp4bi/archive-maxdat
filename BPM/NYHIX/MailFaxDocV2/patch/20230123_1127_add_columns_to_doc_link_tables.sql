-- Add new columns to doc_link_stg and doc_link_hist_stg
-- doc_link_stg -- first_name, last_name
-- doc_link_stg_bkp -- first_name, last_name
-- doc_link_hist_stg -- hx_id, account_id, first_name, last_name
ALTER TABLE DOC_LINK_HIST_STG ADD (HX_ID VARCHAR2(15), ACCOUNT_ID VARCHAR2(15), FIRST_NAME VARCHAR2(100), LAST_NAME VARCHAR2(100));
ALTER TABLE DOC_LINK_STG ADD (FIRST_NAME VARCHAR2(100), LAST_NAME VARCHAR2(100));
ALTER TABLE DOC_LINK_STG_BKP ADD (FIRST_NAME VARCHAR2(100), LAST_NAME VARCHAR2(100));
DROP VIEW MAXDAT.DOC_LINK_SV;
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "MAXDAT"."DOC_LINK_SV" ("DOC_LINK_ID", "DOCUMENT_ID", "LINK_TYPE_CD", "AUTO_LINKED_IND", "CREATED_BY", "CREATE_TS", "CASE_ID", "CASE_CIN", "CLIENT_ID", "CLNT_CIN", "LINK_REF_ID", "ACCOUNT_ID", "HX_ID", "FIRST_NAME", "LAST_NAME") AS 
  SELECT D.DOC_LINK_ID,
D.DOCUMENT_ID,
D.LINK_TYPE_CD,
D.AUTO_LINKED_IND,
D.CREATED_BY,
D.CREATE_TS,
ca.CASE_ID,
CA.CASE_CIN ,
c.clnt_CLIENT_ID,
C.CLNT_CIN,
D.LINK_REF_ID,
d.ACCOUNT_ID,
d.HX_ID,
D.FIRST_NAME,
D.LAST_NAME
FROM MAXDAT.DOC_LINK_STG D
LEFT JOIN MAXDAT.CLIENT_STG C ON C.CLNT_CLIENT_ID = D.CLIENT_ID
LEFT JOIN MAXDAT.CASES_STG CA ON CA.CASE_ID = D.CASE_ID
WITH read only;
GRANT SELECT ON MAXDAT.DOC_LINK_SV TO DP_SCORECARD;
GRANT SELECT ON MAXDAT.DOC_LINK_SV TO MAXDAT_READ_ONLY;
DROP VIEW MAXDAT.DOC_LINK_HIST_SV;
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "MAXDAT"."DOC_LINK_HIST_SV" ("DOC_LINK_HIST_ID", "DOCUMENT_ID", "LINK_TYPE_CD", "AUTO_LINKED_IND", "CREATED_BY", "CREATE_TS", "CASE_ID", "CASE_CIN", "CLIENT_ID", "CLNT_CIN", "LINK_REF_ID", "ACCOUNT_ID", "HX_ID", "FIRST_NAME", "LAST_NAME") AS 
  SELECT D.DOC_LINK_HIST_ID,
D.DOCUMENT_ID,
D.LINK_TYPE_CD,
D.AUTO_LINKED_IND,
D.CREATED_BY,
D.CREATE_TS,
D.CASE_ID,
CA.CASE_CIN ,
D.CLIENT_ID,
C.CLNT_CIN,
D.LINK_REF_ID,
d.ACCOUNT_ID,
d.HX_ID,
D.FIRST_NAME,
D.LAST_NAME
FROM MAXDAT.DOC_LINK_HIST_STG D
LEFT JOIN MAXDAT.CLIENT_STG C ON C.CLNT_CLIENT_ID = D.CLIENT_ID
LEFT JOIN MAXDAT.CASES_STG CA ON CA.CASE_ID = D.CASE_ID
WITH read only;
GRANT SELECT ON MAXDAT.DOC_LINK_HIST_SV TO DP_SCORECARD;
GRANT SELECT ON MAXDAT.DOC_LINK_HIST_SV TO MAXDAT_READ_ONLY;