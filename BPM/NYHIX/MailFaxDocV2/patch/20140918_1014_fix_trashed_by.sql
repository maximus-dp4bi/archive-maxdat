CREATE OR REPLACE VIEW D_NYHIX_MFD_CURRENT_SV_V2
AS
  SELECT
    NYHIX_MFD_BI_ID,
    EEMFDB_ID,
    INSTANCE_STATUS,
    INSTANCE_START_DATE,
    INSTANCE_END_DATE,
    COMPLETE_DT,
    CANCEL_DT,
    CASE
      WHEN LENGTH(S1.LAST_NAME || ', ' || S1.FIRST_NAME) > 2  THEN S1.LAST_NAME || ', '  || S1.FIRST_NAME
      WHEN LENGTH(E1.LAST_NAME || ', ' || E1.FIRST_NAME) > 2  THEN E1.LAST_NAME || ', '  || E1.FIRST_NAME
      ELSE C.CANCEL_BY
    END AS CANCEL_BY,
    CANCEL_REASON,
    CANCEL_METHOD,
    DCN,
    CREATE_DT,
    RECEIVED_DT,
    DOC_TYPE_CD,
    PAGE_COUNT,
    ECN,
    CHANNEL,
    KOFAX_DCN,
    BATCH_ID,
    BATCH_NAME,
    DOC_STATUS_CD,
    DOC_STATUS,
    DOC_STATUS_DT,
    DOC_UPDATE_DT,
    DOC_UPDATED_BY_STAFF_ID,
    CASE
      WHEN LENGTH(S2.LAST_NAME || ', ' || S2.FIRST_NAME) > 2  THEN S2.LAST_NAME || ', '  || S2.FIRST_NAME
      WHEN LENGTH(E2.LAST_NAME || ', ' || E2.FIRST_NAME) > 2  THEN E2.LAST_NAME || ', '  || E2.FIRST_NAME
      ELSE C.DOC_UPDATED_BY_STAFF_ID
    END AS DOC_UPDATED_BY,
    APP_DOC_DATA_ID,
    PRIORITY,
    FORM_TYPE_CD,
    FREE_FORM_TXT_IND,
    PREVIOUS_KOFAX_DCN,
    SCAN_DT,
    RELEASE_DT,
    APP_DOC_TRACKER_ID,
    ENV_STATUS_CD,
    ENV_STATUS,
    ENV_STATUS_DT,
    SLA_COMPLETE_DT,
    ENV_UPDATE_DT,
    ENV_UPDATED_BY_STAFF_ID,
    TRASHED_BY,
    SLA_COMPLETE,
    MAXE_ORIGINATION_DT,
    RESCANNED_IND,
    RETURNED_MAIL_IND,
    RETURNED_MAIL_REASON,
    RESCAN_COUNT,
    NOTE_ID,
    ASF_PROCESS_DOC,
    ASF_CANCEL_DOC,
    TRASHED_DT,
    CASE
      WHEN LENGTH(S3.LAST_NAME || ', ' || S3.FIRST_NAME) > 2  THEN S3.LAST_NAME || ', '  || S3.FIRST_NAME
      WHEN LENGTH(E3.LAST_NAME || ', ' || E3.FIRST_NAME) > 2  THEN E3.LAST_NAME || ', '  || E3.FIRST_NAME
      ELSE C.ENV_UPDATED_BY_STAFF_ID
    END AS ENV_UPDATED_BY,
    TRASHED_IND,
    ORIG_DOC_TYPE_CD,
    ORIG_DOC_FORM_TYPE_CD,
    RESEARCH_REQ_IND,
    EXPEDIATED_IND,
    STG_EXTRACT_DATE,
    STG_LAST_UPDATE_DATE,
    AGE_IN_BUSINESS_DAYS,
    AGE_IN_CALENDAR_DAYS,
    TIMELINESS_STATUS,
    TIMELINESS_DAYS,
    TIMELINESS_DAYS_TYPE,
    TIMELINESS_DATE,
    JEOPARDY_FLAG,
    JEOPARDY_DAYS,
    JEOPARDY_DAYS_TYPE,
    JEOPARDY_DATE,
    SLA_RECEIVED_DATE,
    SLA_AGE_IN_BUSINESS_DAYS,
    SLA_TIMELINESS_STATUS,
    DOC_TYPE,
    FORM_TYPE,
    TARGET_DAYS
  FROM
    D_NYHIX_MFD_CURRENT_V2 C
  LEFT JOIN STAFF_STG S1  ON    cast(S1.STAFF_ID as Char(8)) = cast(C.CANCEL_BY as Char(8))
  LEFT JOIN STAFF_STG S2  ON    cast(S2.STAFF_ID as Char(8)) = cast(C.DOC_UPDATED_BY_STAFF_ID as Char(8))
  LEFT JOIN STAFF_STG S3  ON    cast(S3.STAFF_ID as Char(8)) = cast(C.ENV_UPDATED_BY_STAFF_ID as Char(8)) 
  LEFT JOIN STAFF_STG E1  ON    E1.EXT_STAFF_NUMBER = C.CANCEL_BY
  LEFT JOIN STAFF_STG E2  ON    E2.EXT_STAFF_NUMBER = C.DOC_UPDATED_BY_STAFF_ID
  LEFT JOIN STAFF_STG E3  ON    E3.EXT_STAFF_NUMBER = C.ENV_UPDATED_BY_STAFF_ID;

create or replace public synonym D_NYHIX_MFD_CURRENT_SV_V2 for D_NYHIX_MFD_CURRENT_SV_V2;
grant select on D_NYHIX_MFD_CURRENT_SV_V2 to MAXDAT_READ_ONLY;