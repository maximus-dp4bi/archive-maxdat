-- Create DMS Batches_Stg in MAXDAT
declare  c int;
begin
   select count(*) into c from user_tables where table_name ='D_BATCHES';
   if c = 1 then
      execute immediate 'drop table D_BATCHES cascade constraints';
   end if;
end;
/

CREATE TABLE D_BATCHES 
(
  BATCH_ID NUMBER(38, 0) NOT NULL 
, SOURCE VARCHAR2(15 BYTE) NOT NULL 
, DATE_CAPTURED DATE NOT NULL 
, NAME VARCHAR2(255 BYTE) 
, DOCUMENT_COUNT NUMBER(10, 0) 
, NUMBER_OF_PAGES NUMBER(10, 0) 
, SCAN_STATION VARCHAR2(255 BYTE) 
, CREATION_DATE DATE NOT NULL 
, LAST_UPDATE_DATE DATE NOT NULL 
, CONSTRAINT BATCH_PK PRIMARY KEY 
  (
    BATCH_ID 
  )
  ENABLE 
) 
tablespace MAXDAT_DATA parallel 2;

COMMENT ON COLUMN D_BATCHES.BATCH_ID IS 'Synthetic key generated by sequence';
COMMENT ON COLUMN D_BATCHES.SOURCE IS 'Source of batch.  Examples include fax, scan, and bulk load.';
COMMENT ON COLUMN D_BATCHES.DATE_CAPTURED IS 'Date document was captured into system for processing.';
COMMENT ON COLUMN D_BATCHES.NAME IS 'Name of batch';
COMMENT ON COLUMN D_BATCHES.DOCUMENT_COUNT IS 'Number of documents in batch';
COMMENT ON COLUMN D_BATCHES.NUMBER_OF_PAGES IS 'Number of pages in batch';
COMMENT ON COLUMN D_BATCHES.SCAN_STATION IS 'Workstation used to scan the batch';
COMMENT ON COLUMN D_BATCHES.CREATION_DATE IS 'Creation date of the record (audit attribute)';
COMMENT ON COLUMN D_BATCHES.LAST_UPDATE_DATE IS 'When was the record last updated (audit attribute)';

CREATE INDEX D_BATCHES_DATE_CAP_IDX ON D_BATCHES (DATE_CAPTURED ASC) online TABLESPACE MAXDAT_INDX PARALLEL 2 compute statistics;

grant select on D_BATCHES to MAXDAT_READ_ONLY; 

execute MAXDAT_ADMIN.GATHER_TABLE_STATS('MAXDAT','D_BATCHES',4);

declare  c int;
begin
   select count(*) into c from user_tables where table_name ='D_DOCUMENTS';
   if c = 1 then
      execute immediate 'drop table D_DOCUMENTS cascade constraints';
   end if;
end;
/

CREATE TABLE D_DOCUMENTS 
(
  DCN NUMBER(38, 0) NOT NULL 
, BATCH_ID NUMBER(38, 0) NOT NULL 
, DATE_RECEIVED DATE NOT NULL 
, FORM_TYPE VARCHAR2(255 BYTE) 
, NUMBER_OF_PAGES NUMBER(10, 0) 
, ECN NUMBER(38, 0) 
, KOFAX_DCN VARCHAR2(255 BYTE) 
, CREATION_DATE DATE NOT NULL 
, LAST_UPDATE_DATE DATE NOT NULL 
, CONSTRAINT DOC_PK PRIMARY KEY 
  (
    DCN 
  )
  ENABLE 
) 
TABLESPACE MAXDAT_DATA 
PARALLEL 2;

COMMENT ON COLUMN D_DOCUMENTS.DCN IS 'System generated sequence number';
COMMENT ON COLUMN D_DOCUMENTS.BATCH_ID IS 'Synthetic key generated by sequence';
COMMENT ON COLUMN D_DOCUMENTS.DATE_RECEIVED IS 'Date document was received based on timestamp of fax file or date scanned (with override option for scan operator)';
COMMENT ON COLUMN D_DOCUMENTS.FORM_TYPE IS 'Value passed from capture software showing type of form identified';
COMMENT ON COLUMN D_DOCUMENTS.NUMBER_OF_PAGES IS 'Number of pages in the document';
COMMENT ON COLUMN D_DOCUMENTS.ECN IS 'Assigned Envelope Control Number';
COMMENT ON COLUMN D_DOCUMENTS.KOFAX_DCN IS 'KOFAX generated DCN number that this document replaces';
COMMENT ON COLUMN D_DOCUMENTS.CREATION_DATE IS 'Creation date of the record (audit attribute)';
COMMENT ON COLUMN D_DOCUMENTS.LAST_UPDATE_DATE IS 'When was the record last updated (audit attribute)';

CREATE INDEX D_DOC_CREATED_DATE_IDX ON D_DOCUMENTS (CREATION_DATE ASC) online TABLESPACE MAXDAT_INDX PARALLEL 2 compute statistics;
CREATE INDEX D_DOC_BATCH_ID_IDX ON D_DOCUMENTS (BATCH_ID ASC) online TABLESPACE MAXDAT_INDX PARALLEL 2 compute statistics;

grant select on D_DOCUMENTS to MAXDAT_READ_ONLY; 

execute MAXDAT_ADMIN.GATHER_TABLE_STATS('MAXDAT','D_DOCUMENTS',4);
