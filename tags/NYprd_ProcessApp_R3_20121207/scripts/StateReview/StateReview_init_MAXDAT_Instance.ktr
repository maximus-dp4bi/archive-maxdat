<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>StateReview_init_MAXDAT_Instance</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
<trans-log-table><connection/>
<schema/>
<table/>
<size_limit_lines/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STATUS</id><enabled>Y</enabled><name>STATUS</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name><subject/></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name><subject/></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name><subject/></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name><subject/></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name><subject/></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name><subject/></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>STARTDATE</id><enabled>Y</enabled><name>STARTDATE</name></field><field><id>ENDDATE</id><enabled>Y</enabled><name>ENDDATE</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>DEPDATE</id><enabled>Y</enabled><name>DEPDATE</name></field><field><id>REPLAYDATE</id><enabled>Y</enabled><name>REPLAYDATE</name></field><field><id>LOG_FIELD</id><enabled>Y</enabled><name>LOG_FIELD</name></field></trans-log-table>
<perf-log-table><connection/>
<schema/>
<table/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>SEQ_NR</id><enabled>Y</enabled><name>SEQ_NR</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>INPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>INPUT_BUFFER_ROWS</name></field><field><id>OUTPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>OUTPUT_BUFFER_ROWS</name></field></perf-log-table>
<channel-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>LOGGING_OBJECT_TYPE</id><enabled>Y</enabled><name>LOGGING_OBJECT_TYPE</name></field><field><id>OBJECT_NAME</id><enabled>Y</enabled><name>OBJECT_NAME</name></field><field><id>OBJECT_COPY</id><enabled>Y</enabled><name>OBJECT_COPY</name></field><field><id>REPOSITORY_DIRECTORY</id><enabled>Y</enabled><name>REPOSITORY_DIRECTORY</name></field><field><id>FILENAME</id><enabled>Y</enabled><name>FILENAME</name></field><field><id>OBJECT_ID</id><enabled>Y</enabled><name>OBJECT_ID</name></field><field><id>OBJECT_REVISION</id><enabled>Y</enabled><name>OBJECT_REVISION</name></field><field><id>PARENT_CHANNEL_ID</id><enabled>Y</enabled><name>PARENT_CHANNEL_ID</name></field><field><id>ROOT_CHANNEL_ID</id><enabled>Y</enabled><name>ROOT_CHANNEL_ID</name></field></channel-log-table>
<step-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>LOG_FIELD</id><enabled>N</enabled><name>LOG_FIELD</name></field></step-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <created_user>-</created_user>
  <created_date>2012&#47;08&#47;07 17:45:22.283</created_date>
  <modified_user>-</modified_user>
  <modified_date>2012&#47;08&#47;07 17:45:22.283</modified_date>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>MAXDAT</name>
    <server>${DB_MAXDAT_HOSTNAME}</server>
    <type>ORACLE</type>
    <access>JNDI</access>
    <database>${JNDI_MAXDAT_SOURCE}</database>
    <port>${DB_MAXDAT_PORT}</port>
    <username>${DB_MAXDAT_USER}</username>
    <password>${DB_MAXDAT_PASSWORD}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>INITIAL_POOL_SIZE</code><attribute>5</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>MAXIMUM_POOL_SIZE</code><attribute>10</attribute></attribute>
      <attribute><code>POOLING_initialSize</code><attribute>${INIT_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_logAbandoned</code><attribute>false</attribute></attribute>
      <attribute><code>POOLING_maxActive</code><attribute>${MAX_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_testOnBorrow</code><attribute>true</attribute></attribute>
      <attribute><code>POOLING_validationQuery</code><attribute>select 1 from dual</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DB_MAXDAT_PORT}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>Y</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>NYECDMS</name>
    <server>${DB_DMS_HOSTNAME}</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>${DB_DMS_NAME}</database>
    <port>${DB_DMS_PORT}</port>
    <username>${DB_DMS_USER}</username>
    <password>${DB_DMS_PASSWORD}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>INITIAL_POOL_SIZE</code><attribute>5</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>MAXIMUM_POOL_SIZE</code><attribute>${MAX_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_initialSize</code><attribute>${INIT_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_logAbandoned</code><attribute>false</attribute></attribute>
      <attribute><code>POOLING_maxActive</code><attribute>${MAX_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_testOnBorrow</code><attribute>true</attribute></attribute>
      <attribute><code>POOLING_validationQuery</code><attribute>select 1 from dual</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DB_DMS_PORT}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>Y</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>NYECDMSD</name>
    <server>${DB_DMS_HOSTNAME}</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>${DB_DMS_NAME}</database>
    <port>${DB_DMS_PORT}</port>
    <username>${DB_DMS_USER}</username>
    <password>${DB_DMS_PASSWORD}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>INITIAL_POOL_SIZE</code><attribute>5</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>MAXIMUM_POOL_SIZE</code><attribute>10</attribute></attribute>
      <attribute><code>POOLING_initialSize</code><attribute>${INIT_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_logAbandoned</code><attribute>false</attribute></attribute>
      <attribute><code>POOLING_maxActive</code><attribute>${MAX_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_testOnBorrow</code><attribute>true</attribute></attribute>
      <attribute><code>POOLING_validationQuery</code><attribute>select 1 from dual</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DB_DMS_PORT}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>Y</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>OLTP_SOURCE</name>
    <server>${DB_OLTP_HOSTNAME}</server>
    <type>ORACLE</type>
    <access>JNDI</access>
    <database>${JNDI_OLTP_SOURCE}</database>
    <port>${DB_MAXDAT_PORT}</port>
    <username>${DB_OLTP_USER}</username>
    <password>${DB_OLTP_PASSWORD}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>INITIAL_POOL_SIZE</code><attribute>5</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>MAXIMUM_POOL_SIZE</code><attribute>10</attribute></attribute>
      <attribute><code>POOLING_initialSize</code><attribute>${INIT_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_logAbandoned</code><attribute>false</attribute></attribute>
      <attribute><code>POOLING_maxActive</code><attribute>${MAX_POOL_SIZE}</attribute></attribute>
      <attribute><code>POOLING_testOnBorrow</code><attribute>true</attribute></attribute>
      <attribute><code>POOLING_validationQuery</code><attribute>select 1 from dual</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${DB_MAXDAT_PORT}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>Y</attribute></attribute>
    </attributes>
  </connection>
  <order>
  <hop> <from>Table input -- IDs for Queries</from><to>Database join 2 -- Get MAXDAT Data</to><enabled>Y</enabled> </hop>  <hop> <from>Dummy (do nothing) - TRUE</from><to>Update - Data retrieved from MAXDAT</to><enabled>Y</enabled> </hop>  <hop> <from>Database join 2 -- Get MAXDAT Data</from><to>Filter rows-Any change in Tasks</to><enabled>Y</enabled> </hop>  <hop> <from>Filter rows-Any change in Tasks</from><to>Dummy (do nothing) - TRUE</to><enabled>Y</enabled> </hop>  <hop> <from>Filter rows-Any change in Tasks</from><to>Dummy (do nothing) - FALSE</to><enabled>Y</enabled> </hop>  <hop> <from>Dummy (do nothing) - FALSE</from><to>Update - Data retrieved from MAXDAT 2</to><enabled>Y</enabled> </hop>  </order>
  <step>
    <name>Database join 2 -- Get MAXDAT Data</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <copies>3</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>MAXDAT</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT 
       A.stg_App_ID,
       A.stg_Strw_Task_ID,
       A.stg_DC_Task_ID,
       A.stg_Research_Task_ID,
       A.stg_New_strw_Task_ID,
       A.stg_Current_Task_ID,
       A.stg_current_task_type,
       ----------------------------
       A.oltp_New_strw_Task_ID,
       A.oltp_DC_Task_ID,
       A.oltp_Research_Task_ID,
       A.oltp_Current_Task_Id,
        case when si_stg.step_definition_id in (SELECT ref_id
                                       FROM corp_etl_list_lkup
                                       WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                             AND out_var = &apos;State Review&apos;
                                             AND SYSDATE BETWEEN start_date AND end_date)
            then
                &apos;State Review&apos;
            when si_stg.step_definition_id in (SELECT ref_id
                                       FROM corp_etl_list_lkup
                                       WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                             AND out_var = &apos;Data Correction&apos;
                                             AND SYSDATE BETWEEN start_date AND end_date)
            then
                &apos;Data Correction&apos;
            when si_stg.step_definition_id in (SELECT ref_id
                                       FROM corp_etl_list_lkup
                                       WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                             AND out_var = &apos;Research&apos;
                                             AND SYSDATE BETWEEN start_date AND end_date)
            then
                &apos;Research&apos;
            else
                &apos;State Review&apos;
       end as oltp_CURRENT_TASK_TYPE,		
	--si_stg.HIST_STATUS as oltp_CURRENT_TASK_STATUS,		
	--si_stg.hist_create_ts as oltp_Current_Task_Claim_Date,
    (select (case when si_cl_2.hist_status = &apos;CLAIMED&apos; then si_cl_2.hist_create_ts end)
       from step_instance_stg si_cl_2 
      where si_cl_2.step_instance_id = A.stg_Strw_Task_ID
        and si_cl_2.step_instance_history_id = (select min(si_cl_3.step_instance_history_id)
                                               from step_instance_stg si_cl_3
                                              where si_cl_3.step_instance_id = A.stg_Strw_Task_ID
                                              and si_cl_3.hist_status = &apos;CLAIMED&apos;
                                              and si_cl_3.hist_create_ts &gt;= A.stg_assd_receive_state_review                                   
                                              and si_cl_3.hist_create_ts &lt;= ?
                                              ) 
       ) as oltp_strw_task_claimed_date,	
    si_stg.ref_id           as oltp_Application_ID,
	si_stg.step_instance_id as oltp_Task_ID,
    bus_days_between(si_stg.create_ts, SYSDATE) as oltp_BUSINESS_DAYS,
    trunc(SYSDATE - si_stg.create_ts)           as oltp_CALENDAR_DAYS,
    case when exists (select 1
                       from Staff_Lkup Lkup,
                            step_instance_stg si_stg_5 
                      where 1=1
                        and si_stg_5.hist_create_by = Lkup.Staff_id
                        and si_stg_5.step_instance_id = A.stg_Strw_Task_ID
                        and lkup.Staff_id in (select value 
                                                from corp_etl_list_lkup
                                               where name = &apos;STRW_AUTO_CLOSED_BY&apos;) --&apos;AutoCloseStateReviewTasks&apos;.
                        )
         then &apos;Y&apos; else &apos;N&apos; end as oltp_Auto_Close,
     case when exists (select 1
                       from Staff_Lkup Lkup,
                            step_instance_stg si_stg_5 
                      where 1=1
                        and si_stg_5.hist_create_by = Lkup.Staff_id
                        and si_stg_5.step_instance_id = A.stg_Strw_Task_ID
                        and lkup.Staff_id in (select value 
                                                from corp_etl_list_lkup
                                               where name = &apos;STRW_AUTO_REJECTED_BY&apos;) --&apos;Auto-Rejection Process&apos;. 
                        )
         then &apos;Y&apos; else &apos;N&apos; end as oltp_Auto_Reject,
	   &apos;Y&apos; as Inyes
from    
(
select  
        stg.app_id                    as stg_App_ID,
    	stg.state_review_task_id      as stg_Strw_Task_ID,    		
    	stg.data_correction_task_id   as stg_DC_Task_ID,
        stg.research_task_id          as stg_Research_Task_ID,
        stg.new_state_review_task_id  as stg_New_strw_Task_ID,
    	stg.current_task_id           as stg_Current_Task_ID,
        stg.current_task_type         as stg_current_task_type,
        stg.assd_receive_state_review as stg_assd_receive_state_review,       
        (select min(step_instance_id)
          from step_instance_stg   si
         where si.ref_id = stg.app_id  
           and si.ref_type = &apos;APP_HEADER&apos;
           and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                              WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                              AND out_var = &apos;Data Correction&apos; 
                                              AND SYSDATE BETWEEN start_date AND end_date)
           and si.hist_create_ts &gt;= stg.assd_receive_state_review                                   
           and si.hist_create_ts &lt;= ?
           ) as oltp_DC_Task_ID,   
        (select min(step_instance_id)
          from step_instance_stg   si
         where si.ref_id = stg.app_id  
           and si.ref_type = &apos;APP_HEADER&apos;
           and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                              WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                              AND out_var = &apos;Research&apos; 
                                              AND SYSDATE BETWEEN start_date AND end_date)
           and si.hist_create_ts &gt;= stg.assd_receive_state_review
           and si.hist_create_ts &lt;= ?
           ) as oltp_Research_Task_ID,
       (select min(step_instance_id)
          from step_instance_stg   si
         where si.ref_id = stg.app_id  
           and si.ref_type = &apos;APP_HEADER&apos;
           and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                          WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                            AND out_var = &apos;State Review&apos; 
                                            AND SYSDATE BETWEEN start_date AND end_date)
           and si.hist_create_ts &gt;= stg.assd_receive_state_review                                 
           and si.hist_create_ts &lt;= ?
           and si.step_instance_id &lt;&gt; stg.state_review_task_id -- New state Review Task should not be the original state review task(Instance state review task)           
           ) as oltp_New_strw_Task_ID,    
       &#47;*
       Current Task should be the most recent task( Initial State review or Data Correction or Research task).
       But not the New State Review task.
       Initial state review task ID will be the current task ID , which is populated during instance creation; hence need
       NOT look for it here.
       Current Task should be open i.e., UNCLAIMED or CLAIMED.
       *&#47;      
       (select max(step_instance_id)
          from step_instance_stg   si
         where si.ref_id = stg.app_id  
           and si.ref_type = &apos;APP_HEADER&apos;
           and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                              WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                              AND out_var in (&apos;Data Correction&apos;,&apos;Research&apos;)
                                              AND SYSDATE BETWEEN start_date AND end_date)
           and si.hist_create_ts &gt;= stg.assd_receive_state_review                                   
           and si.hist_create_ts &lt;= ?
           --and si.status in (&apos;CLAIMED&apos;,&apos;UNCLAIMED&apos;)
           and not exists (select 1
                             from step_instance_stg si_4
                            WHERE si_4.ref_id = stg.app_id  
                              and si_4.ref_type = &apos;APP_HEADER&apos;
                              and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                                            WHERE NAME = &apos;TASK_MONITOR_TYPE&apos;
                                                              AND out_var = &apos;State Review&apos; 
                                                              AND SYSDATE BETWEEN start_date AND end_date)
                               and si_4.step_instance_id &lt; si.step_instance_id
	                        )
           ) as oltp_Current_Task_Id
from state_review_stg  stg       
  where 1=1
  and stg.instance_status = &apos;ACTIVE&apos;
  --and stg.app_id = 171657 ----------------------------COMMENT LATER
) A,
      step_instance_stg si_stg
WHERE 1=1
and si_stg.step_instance_id =  nvl(A.oltp_Current_Task_Id, A.stg_Current_Task_ID)
AND si_stg.ref_id =  A.stg_App_ID
AND si_stg.REF_TYPE = &apos;APP_HEADER&apos; 
and si_stg.HIST_CREATE_TS &lt;= ?
AND si_stg.step_instance_history_id = (select MAX(step_instance_history_id) 
                                         from step_instance_stg  si_stg_2
     								    where si_stg_2.ref_id = si_stg.ref_id
										  and si_stg_2.ref_type = &apos;APP_HEADER&apos;	 
                                          and si_stg_2.step_instance_id = nvl(A.oltp_Current_Task_Id, A.stg_Current_Task_ID))</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>STATE_REVIEW_CAPTURE_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CAPTURE_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CAPTURE_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CAPTURE_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CAPTURE_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CAPTURE_DATE</name>
        <type>Date</type>
      </field>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>101</xloc>
      <yloc>129</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Dummy (do nothing) - FALSE</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>333</xloc>
      <yloc>242</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Dummy (do nothing) - TRUE</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>564</xloc>
      <yloc>129</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Filter rows-Any change in Tasks</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
<send_true_to>Dummy (do nothing) - TRUE</send_true_to>
<send_false_to>Dummy (do nothing) - FALSE</send_false_to>
    <compare>
<condition>
 <negated>N</negated>
 <conditions>
  <condition>
   <negated>N</negated>
   <leftvalue>STG_DC_TASK_ID</leftvalue>
   <function>&lt;&gt;</function>
   <rightvalue>OLTP_DC_TASK_ID</rightvalue>
   </condition>
  <condition>
   <negated>N</negated>
   <operator>OR</operator>
   <leftvalue>STG_RESEARCH_TASK_ID</leftvalue>
   <function>&lt;&gt;</function>
   <rightvalue>OLTP_RESEARCH_TASK_ID</rightvalue>
   </condition>
  <condition>
   <negated>N</negated>
   <operator>OR</operator>
   <leftvalue>STG_NEW_STRW_TASK_ID</leftvalue>
   <function>&lt;&gt;</function>
   <rightvalue>OLTP_NEW_STRW_TASK_ID</rightvalue>
   </condition>
  <condition>
   <negated>N</negated>
   <operator>OR</operator>
   <leftvalue>STG_CURRENT_TASK_ID</leftvalue>
   <function>&lt;&gt;</function>
   <rightvalue>OLTP_CURRENT_TASK_ID</rightvalue>
   </condition>
  </conditions>
 </condition>
    </compare>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>330</xloc>
      <yloc>129</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Table input -- IDs for Queries</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>MAXDAT</connection>
    <sql>select to_date(value,&apos;yyyy&#47;mm&#47;dd hh24:mi:ss&apos;) as STATE_REVIEW_CAPTURE_DATE 
from corp_etl_control 
where name = &apos;STATE_REVIEW_CAPTURE_DATE&apos;
</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>100</xloc>
      <yloc>26</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Update - Data retrieved from MAXDAT</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <copies>10</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>MAXDAT</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>MAXDAT</schema>
      <table>STATE_REVIEW_STG</table>
      <key>
        <name>STG_APP_ID</name>
        <field>APP_ID</field>
        <condition>=</condition>
        <name2/>
        </key>
      <key>
        <name>STG_STRW_TASK_ID</name>
        <field>STATE_REVIEW_TASK_ID</field>
        <condition>=</condition>
        <name2/>
        </key>
      <value>
        <name>DATA_CORRECTION_TASK_ID</name>
        <rename>OLTP_DC_TASK_ID</rename>
        </value>
      <value>
        <name>RESEARCH_TASK_ID</name>
        <rename>OLTP_RESEARCH_TASK_ID</rename>
        </value>
      <value>
        <name>NEW_STATE_REVIEW_TASK_ID</name>
        <rename>OLTP_NEW_STRW_TASK_ID</rename>
        </value>
      <value>
        <name>CURRENT_TASK_ID</name>
        <rename>OLTP_CURRENT_TASK_ID</rename>
        </value>
      <value>
        <name>CURRENT_TASK_TYPE</name>
        <rename>OLTP_CURRENT_TASK_TYPE</rename>
        </value>
      <value>
        <name>STRW_TASK_CLAIMED_DATE</name>
        <rename>OLTP_STRW_TASK_CLAIMED_DATE</rename>
        </value>
      <value>
        <name>AGE_IN_BUSINESS_DAYS</name>
        <rename>OLTP_BUSINESS_DAYS</rename>
        </value>
      <value>
        <name>AGE_IN_CALENDAR_DAYS</name>
        <rename>OLTP_CALENDAR_DAYS</rename>
        </value>
      <value>
        <name>AUTO_CLOSE_FLAG</name>
        <rename>OLTP_AUTO_CLOSE</rename>
        </value>
      <value>
        <name>AUTO_REJECT_FLAG</name>
        <rename>OLTP_AUTO_REJECT</rename>
        </value>
      <value>
        <name>ITM_UPDATE</name>
        <rename>INYES</rename>
        </value>
      </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>565</xloc>
      <yloc>247</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Update - Data retrieved from MAXDAT 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <copies>10</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>MAXDAT</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>MAXDAT</schema>
      <table>STATE_REVIEW_STG</table>
      <key>
        <name>STG_APP_ID</name>
        <field>APP_ID</field>
        <condition>=</condition>
        <name2/>
        </key>
      <key>
        <name>STG_STRW_TASK_ID</name>
        <field>STATE_REVIEW_TASK_ID</field>
        <condition>=</condition>
        <name2/>
        </key>
      <value>
        <name>STRW_TASK_CLAIMED_DATE</name>
        <rename>OLTP_STRW_TASK_CLAIMED_DATE</rename>
        </value>
      <value>
        <name>AGE_IN_BUSINESS_DAYS</name>
        <rename>OLTP_BUSINESS_DAYS</rename>
        </value>
      <value>
        <name>AGE_IN_CALENDAR_DAYS</name>
        <rename>OLTP_CALENDAR_DAYS</rename>
        </value>
      <value>
        <name>AUTO_CLOSE_FLAG</name>
        <rename>OLTP_AUTO_CLOSE</rename>
        </value>
      <value>
        <name>AUTO_REJECT_FLAG</name>
        <rename>OLTP_AUTO_REJECT</rename>
        </value>
      <value>
        <name>ITM_UPDATE</name>
        <rename>INYES</rename>
        </value>
      </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>333</xloc>
      <yloc>353</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
