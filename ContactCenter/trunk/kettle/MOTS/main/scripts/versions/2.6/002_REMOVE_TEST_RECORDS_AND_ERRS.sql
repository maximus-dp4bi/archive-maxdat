
UPDATE S_METRIC_TEMPLATE
SET IS_PROCESSED='Y'
  , IS_ERROR = 'Y'
WHERE S_METRIC_TEMPLATE_ID IN (
  SELECT DISTINCT REGEXP_SUBSTR(MESSAGE, '[0-9]+') 
  FROM CC_L_ERROR 
  WHERE ERROR_DATE >= to_date('2014-06-26 00:00:00','yyyy-MM-dd hh24:mi:ss')
  AND MESSAGE LIKE '%Foreign Key%');

DELETE FROM CC_L_ERROR 
WHERE MESSAGE IN (
	SELECT DISTINCT MESSAGE 
	FROM CC_L_ERROR 
	WHERE ERROR_DATE >= to_date('2014-06-26 00:00:00','yyyy-MM-dd hh24:mi:ss')
	AND MESSAGE LIKE '%Foreign Key%');
	
INSERT INTO CC_L_PATCH_LOG ( PATCH_VERSION , SCRIPT_SEQUENCE , SCRIPT_NAME) 
VALUES ('2.6','002','002_REMOVE_TEST_RECORDS_AND_ERRS');

COMMIT;