-- select * from metric;

update metric set type = 'Corporate Standard', value_type = 'Decimal', functional_area = 'Contact Center';

CREATE TABLE SEGMENT 
    ( 
     SEGMENT_ID NUMBER (19)  NOT NULL , 
     SEGMENT_NAME VARCHAR2 (100) , 
     CREATE_DATE DATE , 
     LAST_MODIFIED_DATE DATE 
    ) 
    LOGGING 
;

ALTER TABLE SEGMENT
    ADD CONSTRAINT SEGMENT_PK PRIMARY KEY ( SEGMENT_ID ) ;


CREATE SEQUENCE SEQ_SEGMENT
    START WITH 1 
    INCREMENT BY 1 
    MAXVALUE 9999999999999999999 
    MINVALUE 1 
    CACHE 20 
;

CREATE OR REPLACE TRIGGER BI_SEGMENT
    BEFORE INSERT ON SEGMENT
    FOR EACH ROW 
BEGIN
IF INSERTING AND :NEW.SEGMENT_ID IS NULL THEN 
          SELECT SEQ_SEGMENT.NEXTVAL INTO :NEW.SEGMENT_ID FROM DUAL;
          :NEW.CREATE_DATE := SYSDATE;
          :NEW.LAST_MODIFIED_DATE := SYSDATE;
END IF;
END; 
/

ALTER TRIGGER BI_SEGMENT enable;


INSERT INTO SEGMENT (SEGMENT_NAME) VALUES ('Federal');
INSERT INTO SEGMENT (SEGMENT_NAME) VALUES ('Health East');
INSERT INTO SEGMENT (SEGMENT_NAME) VALUES ('Health West');
INSERT INTO SEGMENT (SEGMENT_NAME) VALUES ('Health Central'); 
    
    
ALTER TABLE PROJECT ADD (SEGMENT_ID NUMBER(19));


ALTER TABLE PROJECT 
    ADD CONSTRAINT PROJECT_SEGMENT_FK FOREIGN KEY 
    ( 
     SEGMENT_ID
    ) 
    REFERENCES SEGMENT
    ( 
     SEGMENT_ID
    ) 
    NOT DEFERRABLE 
;

UPDATE PROJECT SET SEGMENT_ID = 3 WHERE PROJECT_NAME = 'HI HIX';
UPDATE PROJECT SET SEGMENT_ID = 2 WHERE PROJECT_NAME = 'NY HIX';
UPDATE PROJECT SET SEGMENT_ID = 2 WHERE PROJECT_NAME = 'VT HIX';
UPDATE PROJECT SET SEGMENT_ID = 2 WHERE PROJECT_NAME = 'CT HIX';
UPDATE PROJECT SET SEGMENT_ID = 2 WHERE PROJECT_NAME = 'DC HIX';
UPDATE PROJECT SET SEGMENT_ID = 1 WHERE PROJECT_NAME = 'CCO - Boise';
UPDATE PROJECT SET SEGMENT_ID = 1 WHERE PROJECT_NAME = 'CCO - Brownsville';
UPDATE PROJECT SET SEGMENT_ID = 2 WHERE PROJECT_NAME = 'MD HIX';

ALTER TABLE PROJECT MODIFY (SEGMENT_ID NUMBER(19) NOT NULL);

CREATE OR REPLACE VIEW SEGMENT_SV AS
SELECT SEGMENT.* FROM SEGMENT ;

CREATE OR REPLACE PUBLIC SYNONYM SEGMENT_SV FOR SEGMENT_SV ;

GRANT SELECT ON SEGMENT_SV TO MAXDAT;

INSERT INTO GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID, GEOGRAPHY_NAME) VALUES (3, 'New York');
INSERT INTO GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID, GEOGRAPHY_NAME) VALUES (4, 'Vermont');
INSERT INTO GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID, GEOGRAPHY_NAME) VALUES (5, 'Connecticut');
INSERT INTO GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID, GEOGRAPHY_NAME) VALUES (6, 'District of Columbia');
INSERT INTO GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID, GEOGRAPHY_NAME) VALUES (7, 'Idaho');
INSERT INTO GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID, GEOGRAPHY_NAME) VALUES (8, 'Texas');
INSERT INTO GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID, GEOGRAPHY_NAME) VALUES (9, 'Maryland');

UPDATE GEOGRAPHY_MASTER SET CREATE_DATE = SYSDATE, LAST_MODIFIED_DATE = SYSDATE WHERE CREATE_DATE IS NULL;



UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 2 
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'HI HIX'
);

UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 3 
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'NY HIX'
);


UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 4
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'VT HIX'
);

UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 5 
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'CT HIX'
);

UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 6 
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'DC HIX'
);

UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 7 
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'CCO - Boise'
);

UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 8 
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'CCO - Brownsville'
);

UPDATE METRIC_USAGE 
SET GEOGRAPHY_MASTER_ID = 9 
WHERE METRIC_USAGE_ID  IN (
  SELECT METRIC_USAGE_ID 
  FROM METRIC_USAGE MU 
  INNER JOIN PROJECT P ON MU.PROJECT_ID = P.PROJECT_ID 
  WHERE PROJECT_NAME = 'MD HIX'
);

