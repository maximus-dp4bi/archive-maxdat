ALTER TABLE CC_S_AGENT
DROP COLUMN AGENT_DESK_SETTINGS_ID;

ALTER TABLE CC_D_AGENT
ADD VERSION NUMBER;  -- after the data is loaded, this column needs to be made a not null column

UPDATE CC_D_AGENT
SET VERSION = 1;

COMMIT;

ALTER TABLE CC_D_AGENT
MODIFY VERSION NUMBER NOT NULL;

ALTER TABLE CC_D_AGENT
DROP (AGENT_DESK_SETTINGS_ID, D_PROJECT_ID, D_PROGRAM_ID, D_GEOGRAPHY_MASTER_ID, D_SITE_ID, D_GROUP_ID);


ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE 
ADD
(   D_PROJECT_ID                NUMBER (19) NOT NULL,
    D_PROGRAM_ID                NUMBER (19) NOT NULL,
    D_GEOGRAPHY_MASTER_ID       NUMBER (19) NOT NULL ,
    D_GROUP_ID                  NUMBER (19) NOT NULL,
    D_SITE_ID                   NUMBER (19) NOT NULL); -- -- after the data is loaded, these column need to be made a not null columns
    
ALTER TABLE CC_F_AGENT_BY_DATE 
ADD
(   D_PROJECT_TARGETS_ID        NUMBER (19) NOT NULL,
    D_PROGRAM_ID                NUMBER (19) NOT NULL,
    D_GEOGRAPHY_MASTER_ID       NUMBER (19) NOT NULL ,
    D_GROUP_ID                  NUMBER (19) NOT NULL,
    D_SITE_ID                   NUMBER (19) NOT NULL); -- -- after the data is loaded, these column need to be made a not null columns   
    
ALTER TABLE CC_F_ACD_AGENT_INTERVAL
ADD 
(  D_PROJECT_ID NUMBER (19) NOT NULL, 
   D_PROGRAM_ID NUMBER (19) NOT NULL, 
   D_GEOGRAPHY_MASTER_ID NUMBER (19) NOT NULL, 
   D_UNIT_OF_WORK_ID NUMBER (19) NOT NULL) ;    --  -- after the data is loaded, these column need to be made a not null columns 
   
-- Re create indexes
-- CC_F_AGENT_ACTIVITY_BY_DATE
  CREATE INDEX CC_F_AGNT_AVL_DT_D_PRG_IDX ON CC_F_AGENT_ACTIVITY_BY_DATE
    (
      D_PROGRAM_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
  CREATE INDEX CC_F_AGNT_AVL_DT_D_GEO_IDX ON CC_F_AGENT_ACTIVITY_BY_DATE
    (
      D_GEOGRAPHY_MASTER_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
  CREATE INDEX CC_F_AGNT_AVL_DT_D_GRP_IDX ON CC_F_AGENT_ACTIVITY_BY_DATE
    (
      D_GROUP_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
  CREATE INDEX CC_F_AGNT_AVL_DT_D_PRJ_IDX ON CC_F_AGENT_ACTIVITY_BY_DATE
    (
      D_PROJECT_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
    
ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE DROP CONSTRAINT F_AGENT_ACT_BY_DATE__UN;

  ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE ADD CONSTRAINT F_AGENT_ACT_BY_DATE__UN UNIQUE
  (
    D_DATE_ID , D_AGENT_ID , D_ACTIVITY_TYPE_ID , D_PROGRAM_ID , D_GEOGRAPHY_MASTER_ID , D_GROUP_ID , D_PROJECT_ID
  )
  ;
  
-- CC_F_AGENT_BY_DATE

CREATE INDEX CC_F_AGNT_BY_DT_PRJ_TRG_ID_IDX ON CC_F_AGENT_BY_DATE
    (
      D_PROJECT_TARGETS_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
  CREATE INDEX CC_F_AGNT_BY_DT_D_PRG_ID_IDX ON CC_F_AGENT_BY_DATE
    (
      D_PROGRAM_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
  CREATE INDEX CC_F_AGNT_BY_DT_D_GEO_ID_IDX ON CC_F_AGENT_BY_DATE
    (
      D_GEOGRAPHY_MASTER_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
  CREATE INDEX CC_F_AGNT_BY_DT_D_GRP_ID_IDX ON CC_F_AGENT_BY_DATE
    (
      D_GROUP_ID ASC
    )
    TABLESPACE MAXDAT_INDX LOGGING ;
    
ALTER TABLE CC_F_AGENT_BY_DATE DROP CONSTRAINT CC_F_AGENT_BY_DATE__UN;

  ALTER TABLE CC_F_AGENT_BY_DATE ADD CONSTRAINT CC_F_AGENT_BY_DATE__UN UNIQUE
  (
    D_DATE_ID , D_AGENT_ID , SUPERVISOR_D_AGENT_ID , MANAGER_D_AGENT_ID , D_PROJECT_TARGETS_ID , D_PROGRAM_ID , D_GEOGRAPHY_MASTER_ID , D_GROUP_ID
  )
  ;
  
-- CC_F_ACD_AGENT_INTERVAL

CREATE INDEX CC_F_ACD_AGENT_INTERVAL_IDX3 ON CC_F_ACD_AGENT_INTERVAL
  (
    D_PROJECT_ID ASC
  )
  TABLESPACE MAXDAT_INDX LOGGING ;
CREATE INDEX CC_F_ACD_AGENT_INTERVAL_IDX4 ON CC_F_ACD_AGENT_INTERVAL
  (
    D_PROGRAM_ID ASC
  )
  TABLESPACE MAXDAT_INDX LOGGING ;
CREATE INDEX CC_F_ACD_AGENT_INTERVAL_IDX5 ON CC_F_ACD_AGENT_INTERVAL
  (
    D_GEOGRAPHY_MASTER_ID ASC
  )
  TABLESPACE MAXDAT_INDX LOGGING ;
CREATE INDEX CC_F_ACD_AGENT_INTERVAL_IDX6 ON CC_F_ACD_AGENT_INTERVAL
  (
    D_UNIT_OF_WORK_ID ASC
  )
  TABLESPACE MAXDAT_INDX LOGGING ;
  
ALTER TABLE  CC_F_ACD_AGENT_INTERVAL DROP CONSTRAINT CC_F_ACD_AGENT_INTERVAL__UN;

ALTER TABLE CC_F_ACD_AGENT_INTERVAL ADD CONSTRAINT CC_F_ACD_AGENT_INTERVAL__UN UNIQUE
(
  D_DATE_ID , D_PROJECT_ID , D_PROGRAM_ID , D_GEOGRAPHY_MASTER_ID , D_UNIT_OF_WORK_ID , D_INTERVAL_ID , D_CONTACT_QUEUE_ID , D_AGENT_ID)
 
;
      
-- Reestablish foreign key constraints

-- CC_F_AGENT_ACTIVITY_BY_DATE

ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE ADD CONSTRAINT CC_F_AGNT_ACT_D_GEO_MSTR_FK FOREIGN KEY ( D_GEOGRAPHY_MASTER_ID ) REFERENCES CC_D_GEOGRAPHY_MASTER ( GEOGRAPHY_MASTER_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE ADD CONSTRAINT CC_F_AGNT_ACT_D_GROUP_FK FOREIGN KEY ( D_GROUP_ID ) REFERENCES CC_D_GROUP ( D_GROUP_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE ADD CONSTRAINT CC_F_AGNT_ACT_D_PROGRAM_FK FOREIGN KEY ( D_PROGRAM_ID ) REFERENCES CC_D_PROGRAM ( PROGRAM_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE ADD CONSTRAINT CC_F_AGNT_ACT_D_PROJECT_FK FOREIGN KEY ( D_PROJECT_ID ) REFERENCES CC_D_PROJECT ( PROJECT_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_ACTIVITY_BY_DATE ADD CONSTRAINT CC_F_AGNT_ACT_D_SITE_FK FOREIGN KEY ( D_SITE_ID ) REFERENCES CC_D_SITE ( D_SITE_ID ) NOT DEFERRABLE ;

-- CC_F_AGENT_BY_DATE

ALTER TABLE CC_F_AGENT_BY_DATE ADD CONSTRAINT CC_F_AGENT_DATE_D_GEO_FK FOREIGN KEY ( D_GEOGRAPHY_MASTER_ID ) REFERENCES CC_D_GEOGRAPHY_MASTER ( GEOGRAPHY_MASTER_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_BY_DATE ADD CONSTRAINT CC_F_AGENT_DATE_D_GROUP_FK FOREIGN KEY ( D_GROUP_ID ) REFERENCES CC_D_GROUP ( D_GROUP_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_BY_DATE ADD CONSTRAINT CC_F_AGENT_DATE_D_PRJ_FK FOREIGN KEY ( D_PROJECT_TARGETS_ID ) REFERENCES CC_D_PROJECT_TARGETS ( D_PROJECT_TARGETS_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_BY_DATE ADD CONSTRAINT CC_F_AGENT_DATE_D_PROGRAM_FK FOREIGN KEY ( D_PROGRAM_ID ) REFERENCES CC_D_PROGRAM ( PROGRAM_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_AGENT_BY_DATE ADD CONSTRAINT CC_F_AGENT_DATE_D_SITE_FK FOREIGN KEY ( D_SITE_ID ) REFERENCES CC_D_SITE ( D_SITE_ID ) NOT DEFERRABLE ;

-- CC_F_ACD_AGENT_INTERVAL

ALTER TABLE CC_F_ACD_AGENT_INTERVAL ADD CONSTRAINT F_ACD_A_INTRVL_D_GEO_FK FOREIGN KEY ( D_GEOGRAPHY_MASTER_ID ) REFERENCES CC_D_GEOGRAPHY_MASTER ( GEOGRAPHY_MASTER_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_ACD_AGENT_INTERVAL ADD CONSTRAINT F_ACD_A_INTRVL_D_PRG_FK FOREIGN KEY ( D_PROGRAM_ID ) REFERENCES CC_D_PROGRAM ( PROGRAM_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_ACD_AGENT_INTERVAL ADD CONSTRAINT F_ACD_A_INTRVL_D_PRJ_FK FOREIGN KEY ( D_PROJECT_ID ) REFERENCES CC_D_PROJECT ( PROJECT_ID ) NOT DEFERRABLE ;

ALTER TABLE CC_F_ACD_AGENT_INTERVAL ADD CONSTRAINT F_ACD_A_INTRVL_D_UOW_FK FOREIGN KEY ( D_UNIT_OF_WORK_ID ) REFERENCES CC_D_UNIT_OF_WORK ( UOW_ID ) NOT DEFERRABLE ;

-- Recompile the semantic views

CREATE OR REPLACE VIEW CC_D_AGENT_SV  AS
SELECT CC_D_AGENT.* FROM CC_D_AGENT ;

create or replace view CC_D_MANAGER_SV as
 select distinct d.*
 from cc_s_agent_supervisor mgr
 inner join cc_s_agent_supervisor sup on mgr.agent_id = sup.supervisor_agent_id
 inner join cc_s_agent a on mgr.supervisor_agent_id = a.agent_id
 inner join cc_d_agent d on a.login_id = d.login_id;
/
 -- supervisor dimension data set (revised to use dim vs. stage in return)
 create or replace view CC_D_SUPERVISOR_SV as
 select distinct d.*
 from cc_s_agent_supervisor sup
 inner join cc_s_agent a on sup.supervisor_agent_id = a.agent_id 
 inner join cc_d_agent d on a.login_id = d.login_id ;
/
CREATE OR REPLACE VIEW CC_F_AGENT_ACTIVITY_BY_DATE_SV  AS
SELECT CC_F_AGENT_ACTIVITY_BY_DATE.* FROM CC_F_AGENT_ACTIVITY_BY_DATE ;

CREATE OR REPLACE VIEW CC_F_AGENT_BY_DATE_SV  AS
SELECT CC_F_AGENT_BY_DATE.* FROM CC_F_AGENT_BY_DATE ;

CREATE OR REPLACE VIEW CC_F_ACD_AGENT_INTERVAL_SV  AS
SELECT CC_F_ACD_AGENT_INTERVAL.* FROM CC_F_ACD_AGENT_INTERVAL ;

grant select on CC_D_MANAGER_SV to MAXDAT_READ_ONLY;
grant select on CC_D_SUPERVISOR_SV to MAXDAT_READ_ONLY;
grant select on CC_F_AGENT_ACTIVITY_BY_DATE_SV to MAXDAT_READ_ONLY;
grant select on CC_F_AGENT_BY_DATE_SV to MAXDAT_READ_ONLY;
grant select on CC_F_ACD_AGENT_INTERVAL_SV to MAXDAT_READ_ONLY;