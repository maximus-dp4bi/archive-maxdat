
CREATE TABLE CC_S_TMP_ACTIVITY_EVENT_TYPE
(
REASONCODE	VARCHAR2(10 BYTE)	
,REASONTEXT	VARCHAR2(250 BYTE)	
,EVENTCODE	VARCHAR2(10 BYTE)
,EVENTDESC VARCHAR2(250 BYTE)
);

CREATE TABLE CC_C_ACD_ACTIVITY_EVENT_TYPE
(
ACD_ACTIVITY_EVENT_TYPE_ID  NUMBER(19)  NOT NULL
,REASONCODE	VARCHAR2(10 BYTE)	
,REASONTEXT	VARCHAR2(250 BYTE)	
,EVENTCODE	VARCHAR2(10 BYTE)
,EVENTDESC VARCHAR2(250 BYTE)
,ACTIVITY VARCHAR2(250 BYTE)
,EXTRACT_DT DATE
,LAST_UPDATE_DT DATE
,LAST_UPDATE_BY VARCHAR2(30 BYTE)
,RECORD_EFF_DT  DATE
,RECORD_END_DT  DATE
);

CREATE INDEX CC_C_ACD_ACT_EVT_TYPE_IDX1 ON CC_C_ACD_ACTIVITY_EVENT_TYPE
  (
    ACD_ACTIVITY_EVENT_TYPE_ID
  );
  
CREATE INDEX CC_C_ACD_ACT_EVT_TYPE_IDX2 ON CC_C_ACD_ACTIVITY_EVENT_TYPE
  (
    REASONCODE
    ,EVENTCODE
  );
  
ALTER TABLE CC_C_ACD_ACTIVITY_EVENT_TYPE ADD CONSTRAINTS CC_C_ACD_ACT_EVT_TYPE_PK PRIMARY KEY
  (
    ACD_ACTIVITY_EVENT_TYPE_ID
  );
  
ALTER TABLE CC_C_ACD_ACTIVITY_EVENT_TYPE ADD CONSTRAINTS CC_C_ACD_ACT_EVT_TYPE_UN UNIQUE
  (
    REASONCODE
    ,EVENTCODE
    ,RECORD_EFF_DT  
    ,RECORD_END_DT 
  );
  
CREATE SEQUENCE SEQ_CC_C_ACD_ACT_EVT_TYPE START WITH 1 INCREMENT BY 1 MAXVALUE 9999999999999999999 MINVALUE 1 CACHE 20;

CREATE OR REPLACE TRIGGER "BIU_CC_C_ACD_ACT_EVT_TYPE" 
  BEFORE INSERT OR UPDATE ON CC_C_ACD_ACTIVITY_EVENT_TYPE 
  FOR EACH ROW 
BEGIN
IF INSERTING AND :NEW.ACD_ACTIVITY_EVENT_TYPE_ID IS NULL THEN 
  SELECT SEQ_CC_C_ACD_ACT_EVT_TYPE.NEXTVAL INTO :NEW.ACD_ACTIVITY_EVENT_TYPE_ID FROM DUAL;
END IF;
IF INSERTING THEN
          :NEW.EXTRACT_DT := SYSDATE;
END IF;
:NEW.LAST_UPDATE_DT := SYSDATE;
:NEW.LAST_UPDATE_BY := USER;
END;
/



CREATE TABLE CC_S_TMP_ACD_AGT_EVT_DETAIL
(
DBDATETIME	DATE,
DATETIME	TIMESTAMP,
SKILLTARGETID	NUMBER(19,0),
LOGINDATETIME	DATE,
DURATION	NUMBER(19,0),
REASONCODE	NUMBER(19,0),
REASONTEXT	VARCHAR2(100 BYTE),
AGENTDESKSETTINGID	NUMBER(19,0),
DATETIME_END	TIMESTAMP,
EVENT	VARCHAR2(10 BYTE),
UTC_DATETIME TIMESTAMP(6),
UTC_DATETIME_END TIMESTAMP(6)
);




-- Staging Table

CREATE TABLE CC_S_ACD_AGENT_ACTIVITY_DETAIL
(
ACD_AGENT_ACTIVITY_DETAIL_ID	NUMBER (19)	NOT NULL, -- ORACLE GENERATED SEQUENCE
AGENT_ID	NUMBER(19)	NOT NULL,
ACTIVITY_EVENT_TYPE_ID	NUMBER(19)	NOT NULL,
ACTIVITY_START_DATETIME	TIMESTAMP,
ACTIVITY_END_DATETIME	TIMESTAMP,
ACTIVITY_DURATION_SECONDS	NUMBER(15,2),
ACTIVITY_DT	DATE,
EXTRACT_DT	DATE	NOT NULL,
LAST_UPDATE_DT	DATE,
LAST_UPDATE_BY	VARCHAR2(30 BYTE),
UTC_ACTIVITY_START_DATETIME TIMESTAMP(6),
UTC_ACTIVITY_END_DATETIME TIMESTAMP(6)
);

CREATE INDEX CC_S_ACD_AGT_ACT_DETAIL_IDX1 ON CC_S_ACD_AGENT_ACTIVITY_DETAIL
  (
    ACD_AGENT_ACTIVITY_DETAIL_ID
  );

CREATE INDEX CC_S_ACD_AGT_ACT_DETAIL_IDX2 ON CC_S_ACD_AGENT_ACTIVITY_DETAIL
  (
    AGENT_ID,
    ACTIVITY_EVENT_TYPE_ID,
    ACTIVITY_DT
  );
  
CREATE INDEX CC_S_ACD_AGT_ACT_DETAIL_IDX3 ON CC_S_ACD_AGENT_ACTIVITY_DETAIL
  (
    ACTIVITY_EVENT_TYPE_ID
  );


ALTER TABLE CC_S_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_S_ACD_AGT_ACT_DETAIL_PK PRIMARY KEY
  (
    ACD_AGENT_ACTIVITY_DETAIL_ID
  );
 
 ALTER TABLE CC_S_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_S_ACD_AGT_ACT_DETAIL_UN UNIQUE
  (
    AGENT_ID,
    ACTIVITY_EVENT_TYPE_ID,
    ACTIVITY_DT,
    UTC_ACTIVITY_START_DATETIME,
    UTC_ACTIVITY_END_DATETIME
   ); 

ALTER TABLE CC_S_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_S_AGT_ACT_D_CC_S_AGT_FK FOREIGN KEY
  (
    AGENT_ID
  ) REFERENCES CC_S_AGENT (AGENT_ID) NOT DEFERRABLE;

ALTER TABLE CC_S_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_S_AGT_ACT_D_CC_C_ACT_TYPE_FK FOREIGN KEY
  (
    ACTIVITY_EVENT_TYPE_ID
  ) REFERENCES CC_C_ACD_ACTIVITY_EVENT_TYPE (ACD_ACTIVITY_EVENT_TYPE_ID) NOT DEFERRABLE;
  
ALTER TABLE CC_S_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_S_AGT_ACT_D_CHECK CHECK
  (
    UTC_ACTIVITY_END_DATETIME >= UTC_ACTIVITY_START_DATETIME
  );
  
CREATE SEQUENCE SEQ_CC_S_ACD_AGT_ACT_DETAIL START WITH 1 INCREMENT BY 1 MAXVALUE 9999999999999999999 MINVALUE 1 CACHE 20;
 
CREATE OR REPLACE TRIGGER BIU_CC_S_ACD_AGT_ACT_DETAIL 
    BEFORE INSERT OR UPDATE ON CC_S_ACD_AGENT_ACTIVITY_DETAIL
    FOR EACH ROW 
BEGIN 
IF INSERTING AND :NEW.ACD_AGENT_ACTIVITY_DETAIL_ID IS NULL THEN 
          SELECT SEQ_CC_S_ACD_AGT_ACT_DETAIL.NEXTVAL INTO :NEW.ACD_AGENT_ACTIVITY_DETAIL_ID FROM DUAL;
END IF;
IF INSERTING THEN 
          :NEW.EXTRACT_DT := SYSDATE;
END IF;
:NEW.LAST_UPDATE_DT := SYSDATE;
:NEW.LAST_UPDATE_BY := USER;
END; 
/


--fact table

CREATE TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL
(
F_AGENT_ACTIVITY_DETAIL_ID	NUMBER(19)	NOT NULL, -- ORACLE GENERATED SEQUENCE
D_DATE_ID	NUMBER(19)	NOT NULL,
D_AGENT_ID	NUMBER(19)	NOT NULL,
ACTIVITY_EVENT_TYPE_ID	NUMBER(19)	NOT NULL,
D_PROGRAM_ID	NUMBER(19)	NOT NULL,
D_GEOGRAPHY_MASTER_ID	NUMBER(19)	NOT NULL,
D_GROUP_ID	NUMBER(19),
D_PROJECT_ID	NUMBER(19)	NOT NULL,
D_SITE_ID	NUMBER(19),
ACTIVITY_START_DATETIME	TIMESTAMP,
ACTIVITY_END_DATETIME	TIMESTAMP,
ACTIVITY_DURATION_SECONDS	NUMBER(15,2),
CREATE_DATE	DATE,
CREATED_BY	VARCHAR2(30 BYTE),
LAST_UPDATE_DATE	DATE,
LAST_UPDATE_BY	VARCHAR2(30 BYTE),
AGENT_LOGIN_ID	NVARCHAR2(100),
UTC_ACTIVITY_START_DATETIME TIMESTAMP(6),
UTC_ACTIVITY_END_DATETIME TIMESTAMP(6)
);

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX1 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
    F_AGENT_ACTIVITY_DETAIL_ID
  );

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX2 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
   D_GEOGRAPHY_MASTER_ID 
  );

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX3 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
    D_GROUP_ID  
  );
  
CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX4 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
    D_PROGRAM_ID
  );
  
CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX5 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
    D_PROJECT_ID
  );
  
CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX6 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
    D_AGENT_ID
  );

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX7 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
    ACTIVITY_EVENT_TYPE_ID
  );

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX8 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL
  (
    D_AGENT_ID,
    ACTIVITY_EVENT_TYPE_ID,
    D_DATE_ID
  );

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX9 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL 
    (
     D_SITE_ID
    ); 

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX10 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL 
    (
     AGENT_LOGIN_ID
    ); 

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX11 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL 
    (
     ACTIVITY_START_DATETIME
    ); 

CREATE INDEX CC_F_AGT_ACT_DETAIL_IDX12 ON CC_F_ACD_AGENT_ACTIVITY_DETAIL 
    (
     UTC_ACTIVITY_START_DATETIME
    );

ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_ACD_AGENT_ACTIVITY_DETAIL_PK PRIMARY KEY
  (
    F_AGENT_ACTIVITY_DETAIL_ID
  );
  
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_ACD_AGENT_ACTIVITY_DETAIL_UN UNIQUE
  (
    D_AGENT_ID,
    ACTIVITY_EVENT_TYPE_ID,
    D_DATE_ID,
    UTC_ACTIVITY_START_DATETIME,
    UTC_ACTIVITY_END_DATETIME
   );
   
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_D_AGENT_FK FOREIGN KEY
  (
    D_AGENT_ID
  ) REFERENCES CC_D_AGENT (D_AGENT_ID) NOT DEFERRABLE;
  
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_ACT_TYPE_FK FOREIGN KEY
  (
    ACTIVITY_EVENT_TYPE_ID
  ) REFERENCES CC_C_ACD_ACTIVITY_EVENT_TYPE (ACD_ACTIVITY_EVENT_TYPE_ID) NOT DEFERRABLE;
 
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_DATES_FK FOREIGN KEY
  (
    D_DATE_ID
  ) REFERENCES CC_D_DATES (D_DATE_ID) NOT DEFERRABLE;
 
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_GEO_MSTR_FK FOREIGN KEY
  (
    D_GEOGRAPHY_MASTER_ID
  ) REFERENCES CC_D_GEOGRAPHY_MASTER (GEOGRAPHY_MASTER_ID) NOT DEFERRABLE;
 
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_GROUP_FK FOREIGN KEY
  (
    D_GROUP_ID
  ) REFERENCES CC_D_GROUP (D_GROUP_ID) NOT DEFERRABLE;
 
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_PROGRAM_FK FOREIGN KEY
  (
    D_PROGRAM_ID
  ) REFERENCES CC_D_PROGRAM (PROGRAM_ID) NOT DEFERRABLE;
 
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_PROJECT_FK FOREIGN KEY
  (
    D_PROJECT_ID
  ) REFERENCES CC_D_PROJECT (PROJECT_ID) NOT DEFERRABLE;
 
ALTER TABLE CC_F_ACD_AGENT_ACTIVITY_DETAIL ADD CONSTRAINTS CC_F_AGT_ACT_DT_SITE_FK FOREIGN KEY
  (
    D_SITE_ID
  ) REFERENCES CC_D_SITE (D_SITE_ID) NOT DEFERRABLE;
 
CREATE SEQUENCE SEQ_CC_F_AGT_ACT_DETAIL START WITH 1 INCREMENT BY 1 MAXVALUE 9999999999999999999 MINVALUE 1 CACHE 20;
 
CREATE OR REPLACE TRIGGER "BIU_CC_F_AGT_ACT_DETAIL" 
  BEFORE INSERT OR UPDATE ON CC_F_ACD_AGENT_ACTIVITY_DETAIL 
  FOR EACH ROW 
BEGIN
IF INSERTING AND :NEW.F_AGENT_ACTIVITY_DETAIL_ID IS NULL THEN 
  SELECT SEQ_CC_F_AGT_ACT_DETAIL.NEXTVAL INTO :NEW.F_AGENT_ACTIVITY_DETAIL_ID FROM DUAL;
  :NEW.CREATE_DATE := SYSDATE;
  :NEW.CREATED_BY := USER; 
END IF;
:NEW.LAST_UPDATE_DATE := SYSDATE;
:NEW.LAST_UPDATE_BY := USER;
END;  
/