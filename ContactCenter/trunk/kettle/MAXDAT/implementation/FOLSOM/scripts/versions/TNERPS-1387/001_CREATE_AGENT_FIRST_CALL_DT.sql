--Create new staging table for Agent First Call Date

CREATE SEQUENCE SEQ_CC_S_AGENT_FIRST_CALL_DT START WITH 1 INCREMENT BY 1 MAXVALUE 9999999999999999999 MINVALUE 1 CACHE 20 ;

CREATE TABLE CC_S_AGENT_FIRST_CALL_DT
(AGENT_CALL_DT_ID NUMBER NOT NULL,
AGENT_ID NUMBER(19,0),
LOGIN_ID NVARCHAR2(100),
FIRST_NAME VARCHAR2(50),
LAST_NAME VARCHAR2(50),
PROJECT_NAME VARCHAR2(50),
JOB_TITLE VARCHAR2(50),
DEPARTMENT VARCHAR2(50),
AGENT_CALL_DT DATE,
EXTRACT_DT                     DATE DEFAULT SYSDATE NOT NULL ,
LAST_UPDATE_DT                 DATE DEFAULT SYSDATE NOT NULL ,
LAST_UPDATE_BY                 VARCHAR2 (30) NOT NULL
);

ALTER TABLE CC_S_AGENT_FIRST_CALL_DT ADD CONSTRAINT CC_S_AGENT_FIRST_CALL_DT_PK PRIMARY KEY
(
  AGENT_CALL_DT_ID
)
;

CREATE OR REPLACE TRIGGER BIU_CC_S_AGENT_FIRST_CALL_DT
    BEFORE INSERT OR UPDATE ON CC_S_AGENT_FIRST_CALL_DT
    FOR EACH ROW 
    ENABLE 
BEGIN 
IF INSERTING AND :NEW.AGENT_CALL_DT_ID IS NULL THEN 
          SELECT SEQ_CC_S_AGENT_FIRST_CALL_DT.NEXTVAL INTO :NEW.AGENT_CALL_DT_ID FROM DUAL;
END IF;
IF INSERTING THEN 
          :NEW.EXTRACT_DT := SYSDATE;
END IF;
IF :NEW.LAST_UPDATE_BY IS NULL THEN 
          :NEW.LAST_UPDATE_BY := USER;
END IF;
:NEW.LAST_UPDATE_DT := SYSDATE;
END; 
/

--Create semantic view on the staging table

CREATE OR REPLACE VIEW CC_S_AGENT_FIRST_CALL_DT_SV
AS SELECT 
	* FROM CC_S_AGENT_FIRST_CALL_DT;

GRANT SELECT ON CC_S_AGENT_FIRST_CALL_DT_SV TO MAXDAT_READ_ONLY;
