CREATE OR REPLACE VIEW CC_F_IVR_PERFORMANCE_INTERVAL_SV AS 
SELECT
D_DATE_ID          
,D_INTERVAL_ID      
,D_PROJECT_ID       
,D_PROGRAM_ID       
,IVR_SOURCE         
,IVR_APPLICATION_NAME     
,IVR_LANG_ID  
, INBOUND_DNIS          
, INBOUND_DNIS_TYPE    
, IVR_EXIT_RESULT
, IVR_EXIT_RESULT_DETAIL
, MAIN_MENU_SELECTION
, SELF_SERVICE_DESCRIPTION
, DESTINATION_TRANSFER
, IVR_EXIT_POINT 
, IVR_EXIT_CAUSE 
, AGENT_ROUTING_GROUP_ID
, D_UNIT_OF_WORK_ID             
, D_CONTACT_QUEUE_ID
, D_DATE_ID_LOCAL
, D_INTERVAL_ID_LOCAL
, local_timezone 
, AGENT_ROUTING_GROUP_NUMBER
, AGENT_ROUTING_GROUP_NAME
, AGENT_ROUTING_GROUP_TYPE
, CALLS_RECEIVED_IN_IVR        
, CALLS_ROUTED_TO_AGENT       
, CALLS_CONTAINED_IN_IVR     
, CALLS_RECEIVED_AFTER_HOURS 
, TOTAL_DURATION_IN_IVR   
, AVG_DURATION_IN_IVR      
, MIN_DURATION_IN_IVR          
, MAX_DURATION_IN_IVR          
FROM (
SELECT 
--F_IVR_PERFORMANCE_INTERVAL_ID   
D_DATE_ID          
,D_INTERVAL_ID      
,D_PROJECT_ID       
,D_PROGRAM_ID       
,IVR_SOURCE         
,IVR_APPLICATION_NAME     
,IVR_LANG_ID  
, INBOUND_DNIS          
, INBOUND_DNIS_TYPE    
, IVR_EXIT_RESULT
, IVR_EXIT_RESULT_DETAIL
, MAIN_MENU_SELECTION
, SELF_SERVICE_DESCRIPTION
, DESTINATION_TRANSFER
, IVR_EXIT_POINT 
, IVR_EXIT_CAUSE 
, AGENT_ROUTING_GROUP_ID
, D_UNIT_OF_WORK_ID             
, D_CONTACT_QUEUE_ID
, D_DATE_ID_LOCAL
, D_INTERVAL_ID_LOCAL
, local_timezone 
,COUNT(1)                         CALLS_RECEIVED_IN_IVR        
,SUM(CALL_ROUTED_TO_AGENT)       CALLS_ROUTED_TO_AGENT       
,SUM(CALL_CONTAINED_IN_IVR)      CALLS_CONTAINED_IN_IVR     
,SUM(CALL_RECEIVED_AFTER_HOURS)  CALLS_RECEIVED_AFTER_HOURS 
,SUM(DURATION_IN_IVR)             TOTAL_DURATION_IN_IVR   
,CAST(ROUND(SUM(DURATION_IN_IVR)/COUNT(1),2) AS DECIMAL(10,2))     AVG_DURATION_IN_IVR      
,MIN(DURATION_IN_IVR)                        MIN_DURATION_IN_IVR          
,MAX(DURATION_IN_IVR)                        MAX_DURATION_IN_IVR          
FROM
(
SELECT /*+ PARALLEL(20) */
IVRPI.D_DATE_ID
,IVRPI.D_INTERVAL_ID
,IVRPI.D_PROJECT_ID
,IVRPI.D_PROGRAM_ID
,IVRPI.IVR_SOURCE
,IVRPI.IVR_APPLICATION_NAME
,IVRPI.IVR_LANG_ID
,IVRPI.INBOUND_DNIS
,IVRPIE.inbound_dnis_type           
--,IVRPIE.unit_of_work 
,IVRPIE.AGENT_ROUTING_GROUP_ID
,IVRPIE.D_UNIT_OF_WORK_ID               
,IVRPIE.D_CONTACT_QUEUE_ID               
,IVRPIE.ivr_exit_result             
,IVRPIE.IVR_EXIT_RESULT_DETAIL      
,IVRPIE.CALL_CONTAINED_IN_IVR       
,IVRPIE.CALL_ROUTED_TO_AGENT        
,IVRPIE.CALL_RECEIVED_AFTER_HOURS
,IVRPI.MAIN_MENU_SELECTION
,IVRPI.SELF_SERVICE_DESCRIPTION
,IVRPI.DESTINATION_TRANSFER
,IVRPI.IVR_EXIT_CAUSE
,IVRPI.IVR_EXIT_POINT
,IVRPI.IVR_CALL_DATE
,IVRPI.DURATION_IN_IVR
,IVRPI.D_DATE_ID_LOCAL
,IVRPI.D_INTERVAL_ID_LOCAL
,IVRPI.local_timezone 
FROM CC_F_IVR_PERFORMANCE_INSTANCE IVRPI
LEFT JOIN (SELECT 
      S_IVR_PERFORMANCE_INSTANCE_EXT_ID
      ,F_IVR_PERFORMANCE_INSTANCE_ID
      ,inbound_dnis_type         
      ,unit_of_work              
      ,AGENT_ROUTING_GROUP_ID
      ,D_UNIT_OF_WORK_ID               
      ,D_CONTACT_QUEUE_ID               
      ,ivr_exit_result           
      ,IVR_EXIT_RESULT_DETAIL    
      ,CALL_CONTAINED_IN_IVR     
      ,CALL_ROUTED_TO_AGENT      
      ,CALL_RECEIVED_AFTER_HOURS
      FROM (
           SELECT IEXT.*
           , ROW_NUMBER() OVER (PARTITION BY IEXT.F_IVR_PERFORMANCE_INSTANCE_ID ORDER BY IEXT.S_IVR_PERFORMANCE_INSTANCE_EXT_ID DESC) ROWN 
           FROM CC_S_IVR_PERFORMANCE_INSTANCE_EXT IEXT
      )
      WHERE ROWN = 1
      ) IVRPIE ON IVRPI.F_IVR_PERFORMANCE_INSTANCE_ID = IVRPIE.F_IVR_PERFORMANCE_INSTANCE_ID
)
GROUP BY 
D_DATE_ID          
,D_INTERVAL_ID      
,D_PROJECT_ID       
,D_PROGRAM_ID       
,IVR_SOURCE         
,IVR_APPLICATION_NAME     
,IVR_LANG_ID  
, INBOUND_DNIS          
, INBOUND_DNIS_TYPE    
, IVR_EXIT_RESULT
, IVR_EXIT_RESULT_DETAIL
, MAIN_MENU_SELECTION
, SELF_SERVICE_DESCRIPTION
, DESTINATION_TRANSFER
, IVR_EXIT_POINT 
, IVR_EXIT_CAUSE 
, AGENT_ROUTING_GROUP_ID
, D_UNIT_OF_WORK_ID             
, D_CONTACT_qUEUE_ID
, D_DATE_ID_LOCAL
, D_INTERVAL_ID_LOCAL
, local_timezone 
) IVR
LEFT JOIN CC_C_AGENT_RTG_GRP ARG ON ARG.C_AGENT_ROUTING_GROUP_ID = IVR.AGENT_ROUTING_GROUP_ID AND ARG.RECORD_EFF_DT <= TRUNC(SYSDATE) AND ARG.RECORD_END_DT >= TRUNC(SYSDATE)
;

--select * from CC_F_IVR_PERFORMANCE_INTERVAL_SV

GRANT SELECT ON CC_F_IVR_PERFORMANCE_INTERVAL_SV TO CISCO_READ_ONLY;
GRANT SELECT ON CC_F_IVR_PERFORMANCE_INTERVAL_SV TO MAXDAT_READ_ONLY;


