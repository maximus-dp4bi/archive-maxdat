<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>StateReview_init_MAXDAT_Instance</name>
    <description/>
    <extended_description>Do not edit these four SVN_* variable values.  They are populated when you commit code to SVN and used later to identify deployed code.

    ---------------------------------

    SVN_FILE_URL        = $URL$

    SVN_REVISION        = $Revision$

    SVN_REVISION_DATE   = $Date$

    SVN_REVISION_AUTHOR = $Author$

    ---------------------------------
    </extended_description>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2012/08/07 17:45:22.283</created_date>
    <modified_user>-</modified_user>
    <modified_date>2012/08/07 17:45:22.283</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>This transformation fetches the earliest Data Correction AND/OR Research AND/OR 
New State Review task AND the Current Task for the instance. Current Task can be 
either the Initial State Review OR Data Correction or Research, but NOT the New State
Review Task.</note>
      <xloc>60</xloc>
      <yloc>549</yloc>
      <width>519</width>
      <heigth>70</heigth>
      <fontname>Arial</fontname>
      <fontsize>10</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>165</backgroundcolorgreen>
      <backgroundcolorblue>0</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>UPDATED APPS ONLY.</note>
      <xloc>62</xloc>
      <yloc>504</yloc>
      <width>153</width>
      <heigth>25</heigth>
      <fontname>Arial</fontname>
      <fontsize>10</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>165</backgroundcolorgreen>
      <backgroundcolorblue>0</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
  </notepads>
  <connection>
    <name>MAXDAT</name>
    <server>${DB_MAXDAT_HOSTNAME_IL}</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>${DB_MAXDAT_NAME_IL}</database>
    <port>${DB_MAXDAT_PORT_IL}</port>
    <username>${DB_MAXDAT_USER_IL}</username>
    <password>Encrypted 2be98afc86aa7f2aebe15b7318cc2fe83</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>INITIAL_POOL_SIZE</code>
        <attribute>5</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MAXIMUM_POOL_SIZE</code>
        <attribute>10</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${DB_MAXDAT_PORT_IL}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>STRICT_NUMBER_38_INTERPRETATION</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>Y</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Table input -- IDs for Queries</from>
      <to>Database join-- Get MAXDAT Data</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Dummy (do nothing) - TRUE</from>
      <to>Update - Change in Tasks</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Database join-- Get MAXDAT Data</from>
      <to>Filter rows-Any change in Tasks</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows-Any change in Tasks</from>
      <to>Dummy (do nothing) - TRUE</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows-Any change in Tasks</from>
      <to>Dummy (do nothing) - FALSE</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Dummy (do nothing) - FALSE</from>
      <to>Update - No Change in Tasks</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Database join-- Get MAXDAT Data</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>MAXDAT</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT 
       B.stg_nesr_id,
       B.stg_App_ID,
       B.stg_Strw_Task_ID,
       B.stg_DC_Task_ID,
       B.stg_Research_Task_ID,
       B.stg_New_strw_Task_ID,
       B.stg_Current_Task_ID,
       B.stg_current_task_type,
       ----------------------------      
       B.oltp_New_strw_Task_ID,
       B.oltp_DC_Task_ID,
       B.oltp_Research_Task_ID,
       nvl(nvl(B.oltp_Research_Task_ID, B.oltp_DC_Task_ID), B.stg_Strw_Task_ID) as oltp_Current_Task_Id,
       (select distinct
            case when si_stg.step_definition_id in (SELECT ref_id
                                       FROM corp_etl_list_lkup
                                       WHERE NAME = 'TASK_MONITOR_TYPE'
                                             AND out_var = 'State Review'
                                             AND SYSDATE BETWEEN start_date AND end_date)
            then
                'State Review'
            when si_stg.step_definition_id in (SELECT ref_id
                                       FROM corp_etl_list_lkup
                                       WHERE NAME = 'TASK_MONITOR_TYPE'
                                             AND out_var = 'Data Correction'
                                             AND SYSDATE BETWEEN start_date AND end_date)
            then
                'Data Correction'
            when si_stg.step_definition_id in (SELECT ref_id
                                       FROM corp_etl_list_lkup
                                       WHERE NAME = 'TASK_MONITOR_TYPE'
                                             AND out_var = 'Research'
                                             AND SYSDATE BETWEEN start_date AND end_date)
            then
                'Research'
            else
                'State Review'
       end
     from step_instance_stg si_stg,
          step_definition_stg def
     where si_stg.step_instance_id = nvl(nvl(B.oltp_Research_Task_ID, B.oltp_DC_Task_ID), B.stg_Strw_Task_ID)
       and si_stg.step_definition_id =  def.step_definition_id
       ) as  oltp_CURRENT_TASK_TYPE   
       ,		
    (select distinct first_value(si_cl_2.hist_create_ts) over (partition by si_cl_2.step_instance_id order by si_cl_2.hist_create_ts)
       from step_instance_stg si_cl_2 
      where si_cl_2.step_instance_id = B.stg_Strw_Task_ID
        and si_cl_2.hist_status = 'CLAIMED'
        and si_cl_2.hist_create_ts >= B.stg_assd_receive_state_review                                   
        and si_cl_2.hist_create_ts &lt;= ?--&amp;p_snapshot_date        
       ) as oltp_strw_task_claimed_date,
    --bus_days_between(stg_assd_receive_state_review, SYSDATE) as oltp_BUSINESS_DAYS,
    --trunc(SYSDATE - stg_assd_receive_state_review)           as oltp_CALENDAR_DAYS,
    case when exists (select 1
                       from Staff_Lkup Lkup,
                            step_instance_stg si_stg_5 
                      where 1=1
                        and si_stg_5.hist_create_by = Lkup.Staff_id
                        and si_stg_5.step_instance_id = B.stg_Strw_Task_ID
                        and lkup.Staff_id in (select value 
                                                from corp_etl_list_lkup
                                               where name = 'STRW_AUTO_CLOSED_BY') --'AutoCloseStateReviewTasks'.
                        )
         then 'Y' else 'N' end as oltp_Auto_Close,
     case when exists (select 1
                       from Staff_Lkup Lkup,
                            step_instance_stg si_stg_5 
                      where 1=1
                        and si_stg_5.hist_create_by = Lkup.Staff_id
                        and si_stg_5.step_instance_id = B.stg_Strw_Task_ID
                        and lkup.Staff_id in (select value 
                                                from corp_etl_list_lkup
                                               where name = 'STRW_AUTO_REJECTED_BY') --'Auto-Rejection Process'. 
                        )
         then 'Y' else 'N' end as oltp_Auto_Reject,
	   'Y' as Inyes
from    
(
select A.*,
       (select min(step_instance_id)
          from step_instance_stg   si
         where si.ref_id = A.stg_App_ID
           and si.ref_type = 'APP_HEADER'
           and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                              WHERE NAME = 'TASK_MONITOR_TYPE'
                                              AND out_var = 'Data Correction' 
                                              AND SYSDATE BETWEEN start_date AND end_date)
           and si.step_instance_id > A.stg_Strw_Task_ID
           and si.step_instance_id &lt; nvl(A.oltp_New_strw_Task_ID,999999999) -- If no new state review task, then upper bound is 99999999.
           and si.hist_create_ts &lt;= ?--&amp;p_snapshot_date
           ) as oltp_DC_Task_ID, 
        (select min(step_instance_id)
          from step_instance_stg   si
         where si.ref_id = A.stg_App_ID
           and si.ref_type = 'APP_HEADER'
           and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                              WHERE NAME = 'TASK_MONITOR_TYPE'
                                              AND out_var = 'Research'
                                              AND SYSDATE BETWEEN start_date AND end_date)
           and si.step_instance_id > A.stg_Strw_Task_ID
           and si.step_instance_id &lt; nvl(A.oltp_New_strw_Task_ID,999999999) -- If no new state review task, then upper bound is 99999999.
           and si.hist_create_ts &lt;= ?--&amp;p_snapshot_date
           )  as oltp_Research_Task_ID
from (           
select  
       stg.nesr_id                   as stg_nesr_id,
       stg.app_id                    as stg_App_ID,
    	stg.state_review_task_id      as stg_Strw_Task_ID,    		
    	stg.data_correction_task_id   as stg_DC_Task_ID,
      stg.research_task_id          as stg_Research_Task_ID,
      stg.new_state_review_task_id  as stg_New_strw_Task_ID,
    	stg.current_task_id           as stg_Current_Task_ID,
      stg.current_task_type         as stg_current_task_type,
      stg.assd_receive_state_review as stg_assd_receive_state_review, 
       (select min(step_instance_id)
          from step_instance_stg   si
         where si.ref_id = stg.app_id
           and si.ref_type = 'APP_HEADER'
           and si.step_definition_id in (SELECT ref_id FROM corp_etl_list_lkup
                                          WHERE NAME = 'TASK_MONITOR_TYPE'
                                            AND out_var = 'State Review' 
                                            AND SYSDATE BETWEEN start_date AND end_date)
           and si.hist_create_ts > stg.assd_receive_state_review                                 
           and si.hist_create_ts &lt;= ?--&amp;p_snapshot_date
           and si.step_instance_id &lt;&gt; stg.state_review_task_id -- New state Review Task should not be the original state review task(Instance state review task)           
           ) as oltp_New_strw_Task_ID
from state_review_stg  stg       
  where 1=1
  and stg.instance_status = 'Active'
  and stg.app_id = ?
  --and stg.app_id = &amp;p_app_id ----------------------------COMMENT LATER
) A
WHERE 1=1
) B
order by B.stg_Strw_Task_ID</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>STATE_REVIEW_CDC_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CDC_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CDC_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>STATE_REVIEW_CDC_DATE</name>
        <type>Date</type>
      </field>
      <field>
        <name>OLTP_UPDATED_APPS</name>
        <type>Number</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>99</xloc>
      <yloc>155</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Dummy (do nothing) - FALSE</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>331</xloc>
      <yloc>268</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Dummy (do nothing) - TRUE</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>562</xloc>
      <yloc>155</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Filter rows-Any change in Tasks</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>Dummy (do nothing) - TRUE</send_true_to>
    <send_false_to>Dummy (do nothing) - FALSE</send_false_to>
    <compare>
      <condition>
        <negated>N</negated>
        <conditions>
          <condition>
            <negated>N</negated>
            <leftvalue>STG_DC_TASK_ID</leftvalue>
            <function>&lt;></function>
            <rightvalue>OLTP_DC_TASK_ID</rightvalue>
          </condition>
          <condition>
            <negated>N</negated>
            <operator>OR</operator>
            <leftvalue>STG_RESEARCH_TASK_ID</leftvalue>
            <function>&lt;></function>
            <rightvalue>OLTP_RESEARCH_TASK_ID</rightvalue>
          </condition>
          <condition>
            <negated>N</negated>
            <operator>OR</operator>
            <leftvalue>STG_NEW_STRW_TASK_ID</leftvalue>
            <function>&lt;></function>
            <rightvalue>OLTP_NEW_STRW_TASK_ID</rightvalue>
          </condition>
          <condition>
            <negated>N</negated>
            <operator>OR</operator>
            <leftvalue>STG_CURRENT_TASK_ID</leftvalue>
            <function>&lt;></function>
            <rightvalue>OLTP_CURRENT_TASK_ID</rightvalue>
          </condition>
        </conditions>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>328</xloc>
      <yloc>155</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input -- IDs for Queries</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>MAXDAT</connection>
    <sql>select distinct ref_id as oltp_updated_apps,
       (select to_date(value,'yyyy/mm/dd hh24:mi:ss') 
          from corp_etl_control 
          where name = 'STATE_REVIEW_CAPTURE_DATE') as STATE_REVIEW_CDC_DATE
from step_instance_stg sis
where sis.step_instance_history_id > (select value from corp_etl_control
                                      where  name = 'STATE_REVIEW_LAST_STEP_HIST_ID')
and hist_create_ts  &lt;= (select to_date(value,'yyyy/mm/dd hh24:mi:ss')
                          from corp_etl_control 
                         where name = 'STATE_REVIEW_CAPTURE_DATE')
and ref_type = 'APP_HEADER'
--and ref_id = 162596</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>99</xloc>
      <yloc>29</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update - Change in Tasks</name>
    <type>Update</type>
    <description>Updates all the attributes including the task IDs.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>MAXDAT</connection>
    <skip_lookup>Y</skip_lookup>
    <commit>1</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>MAXDAT</schema>
      <table>STATE_REVIEW_STG</table>
      <key>
        <name>STG_NESR_ID</name>
        <field>NESR_ID</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>DATA_CORRECTION_TASK_ID</name>
        <rename>OLTP_DC_TASK_ID</rename>
      </value>
      <value>
        <name>RESEARCH_TASK_ID</name>
        <rename>OLTP_RESEARCH_TASK_ID</rename>
      </value>
      <value>
        <name>NEW_STATE_REVIEW_TASK_ID</name>
        <rename>OLTP_NEW_STRW_TASK_ID</rename>
      </value>
      <value>
        <name>CURRENT_TASK_ID</name>
        <rename>OLTP_CURRENT_TASK_ID</rename>
      </value>
      <value>
        <name>CURRENT_TASK_TYPE</name>
        <rename>OLTP_CURRENT_TASK_TYPE</rename>
      </value>
      <value>
        <name>STRW_TASK_CLAIMED_DATE</name>
        <rename>OLTP_STRW_TASK_CLAIMED_DATE</rename>
      </value>
      <value>
        <name>AUTO_CLOSE_FLAG</name>
        <rename>OLTP_AUTO_CLOSE</rename>
      </value>
      <value>
        <name>AUTO_REJECT_FLAG</name>
        <rename>OLTP_AUTO_REJECT</rename>
      </value>
      <value>
        <name>ITM_UPDATE</name>
        <rename>INYES</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>563</xloc>
      <yloc>273</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update - No Change in Tasks</name>
    <type>Update</type>
    <description>Updates all the attributes except the task IDs.</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>MAXDAT</connection>
    <skip_lookup>Y</skip_lookup>
    <commit>1</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>MAXDAT</schema>
      <table>STATE_REVIEW_STG</table>
      <key>
        <name>STG_NESR_ID</name>
        <field>NESR_ID</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>STRW_TASK_CLAIMED_DATE</name>
        <rename>OLTP_STRW_TASK_CLAIMED_DATE</rename>
      </value>
      <value>
        <name>AUTO_CLOSE_FLAG</name>
        <rename>OLTP_AUTO_CLOSE</rename>
      </value>
      <value>
        <name>AUTO_REJECT_FLAG</name>
        <rename>OLTP_AUTO_REJECT</rename>
      </value>
      <value>
        <name>ITM_UPDATE</name>
        <rename>INYES</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>331</xloc>
      <yloc>379</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
