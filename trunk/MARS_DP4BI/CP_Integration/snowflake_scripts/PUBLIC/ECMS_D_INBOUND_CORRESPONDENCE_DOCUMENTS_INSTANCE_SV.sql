CREATE OR REPLACE VIEW PUBLIC.ECMS_D_INBOUND_CORRESPONDENCE_DOCUMENTS_INSTANCE_SV AS
select 
     ic.project_id AS PROJECT_ID
    ,ic.INBOUND_CORRESPONDENCE_ID AS INBOUND_CORRESPONDENCE_ID
    ,ic.CREATED_BY AS CREATED_BY
    ,cb.BUSINESS_UNIT_ID AS CREATED_BY_BUSINESS_UNIT_ID
    ,cb.BUSINESS_UNIT_NAME AS CREATED_BY_BUSINESS_UNIT_NAME
    ,ic.CREATED_ON AS CREATE_DATE_TIME
    ,ic.RECEIVED_DATE AS RECEIVED_DATE_TIME
    ,ic.STATUS AS INBOUND_CORRESPONDENCE_STATUS
    ,ic.STATUS_DATE AS INBOUND_CRRESPONDENCE_STATUS_DATE_TIME
    ,ic.SCANNED_ON AS INBOUND_CRRESPONDENCE_SCANNED_ON_DATE_TIME
    ,ic.CHANNEL AS INBOUND_CORRESPONDENCE_CHANNEL_TYPE
    ,ic.RETURNED_REASON AS INBOUND_CORRESPONDENCE_RETURNED_REASON
    ,ic.CASE_ID as EXTERNAL_CASE_ID
    ,case when UPPER(STATUS) = 'COMPLETE' then ic.status_date else null end AS PROCESSED_DATE_TIME
    ,ic.UPDATED_BY AS UPDATED_BY
    ,ub.BUSINESS_UNIT_ID AS UPDATED_BY_BUSINESS_UNIT_ID
    ,ub.BUSINESS_UNIT_NAME AS UPDATED_BY_BUSINESS_UNIT_NAME
    ,ic.UPDATED_ON AS UPDATE_DATE_TIME
    ,ic.CORRESPONDENCE_TYPE AS CORRESPONDENCE_TYPE
from 
    MARSDB.MARSDB_INBOUND_CORRESPONDENCE_VW ic
    LEFT JOIN
    D_USER_SV   cb
    ON
    (
            ic.CREATED_BY = TO_CHAR(cb.user_id)
        AND ic.project_id = COALESCE(cb.team_project_id, cb.user_project_id)
    )
    LEFT JOIN
    D_USER_SV   ub
    ON
    (
            ic.UPDATED_BY = TO_CHAR(ub.user_id)
        AND ic.project_id = COALESCE(ub.team_project_id, ub.user_project_id)
    );