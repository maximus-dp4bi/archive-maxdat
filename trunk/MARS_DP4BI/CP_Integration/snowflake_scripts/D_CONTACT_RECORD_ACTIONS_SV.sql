CREATE OR REPLACE VIEW PUBLIC.D_CONTACT_RECORD_ACTIONS_SV AS
SELECT DISTINCT
     CR.PROJECT_ID AS PROJECT_ID
    ,TRUNC(DECODE(RSN.CONTACT_RECORD_REASON_ID, NULL, CR.CONTACT_RECORD_ID, DECODE(ACTN.CONTACT_RECORD_ACTION_ID, NULL, CR.CONTACT_RECORD_ID || RSN.CONTACT_RECORD_REASON_ID, CR.CONTACT_RECORD_ID || RSN.CONTACT_RECORD_REASON_ID || ACTN.CONTACT_RECORD_ACTION_ID))) AS CONTACT_RECORD_ACTIONS_ID
    ,CR.CONTACT_RECORD_ID AS CONTACT_RECORD_ID    
    ,NVL(RSN.CONTACT_RECORD_REASON_TYPE, 'No Reason') AS CONTACT_REASON
    ,NVL(ECRR.REPORT_LABEL, 'No Reason') AS CONTACT_REASON_LABEL
    ,NVL(ACTN.CONTACT_RECORD_ACTION_TYPE, 'No Action') AS CONTACT_ACTION
    ,NVL(ECCRA.REPORT_LABEL, 'No Action') AS CONTACT_ACTION_LABEL
FROM 
    MARSDB.MARSDB_CONTACT_RECORD_VW CR    
LEFT JOIN MARSDB.MARSDB_CONTACT_RECORD_REASON_VW RSN
    ON RSN.PROJECT_ID = CR.PROJECT_ID 
    AND RSN.CONTACT_RECORD_ID = CR.CONTACT_RECORD_ID
LEFT JOIN MARSDB.MARSDB_ENUM_CONTACT_RECORD_ACTION_REASON_VW ECRR
    ON ECRR.PROJECT_ID = RSN.PROJECT_ID 
    AND ECRR.VALUE = RSN.CONTACT_RECORD_REASON_TYPE
LEFT JOIN MARSDB.MARSDB_CONTACT_RECORD_ACTION_VW ACTN
    ON RSN.PROJECT_ID = ACTN.PROJECT_ID 
    AND RSN.CONTACT_RECORD_REASON_ID = ACTN.CONTACT_RECORD_REASON_ID
    AND ACTN.EFFECTIVE_END_DATE IS NULL
LEFT JOIN MARSDB.MARSDB_ENUM_CONTACT_RECORD_ACTION_TYPE_VW ECCRA
    ON ECCRA.PROJECT_ID = ACTN.PROJECT_ID 
    AND ECCRA.VALUE = ACTN.CONTACT_RECORD_ACTION_TYPE
    ;