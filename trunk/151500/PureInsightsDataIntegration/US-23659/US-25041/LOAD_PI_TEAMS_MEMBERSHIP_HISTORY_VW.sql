use role SYSADMIN;
use warehouse PUREINSIGHTS_DEV_LOAD_DAILY_WH;
use database PUREINSIGHTS_DEV;
use schema STAGE;

create or replace view LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW(
	PROJECTID,
	PROGRAMID,
	INGESTIONDATETIME,
	TEAMID,
	TEAMNAME,
	USERID,
	USERNAME,
	DIVISIONID,
	DIVISIONNAME,
	RAW,	
	ROW_HASH,
	SNOWFLAKE_INSERT_DATETIME,
	SNOWFLAKE_UPDATE_DATETIME,
	AS_OF_DATE,
	INSERT_BY,
	CURRENT_USER_RECORD
) COPY GRANTS as         
SELECT 
	PROJECTID,
	PROGRAMID,
	INGESTIONDATETIME,
	TEAMID,
	TEAMNAME,
	USERID,
	USERNAME,
	DIVISIONID,
	DIVISIONNAME,
	RAW,
	HASH(Raw) 											AS ROW_HASH,
	SYSDATE() 											AS SNOWFLAKE_INSERT_DATETIME,
	SYSDATE() 											AS SNOWFLAKE_UPDATE_DATETIME,
	CAST(INGESTIONDATETIME AS DATE) 					AS AS_OF_DATE,
	'PI_USER_LOAD' 										AS INSERT_BY,
	1 													AS CURRENT_USER_RECORD
FROM 
	PUBLIC.D_PI_TEAMS_MEMBERSHIP_VW;

GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO BI_PRODUCT_DEV;   
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO DATA_SUPPORT_ROLE;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO DA_LAB_ADMIN;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO DA_LAB_READ;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO MAX_DEV;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO OPS_ANALYTICS_TEAM;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO PUBLIC;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO INFA_DATA_CATALOG_DEV_READ;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO PUREINSIGHTS_DEV_READ;
GRANT SELECT ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO PI_DATA_INGEST_DEV_ALERT_USER;
GRANT DELETE, INSERT, REBUILD, REFERENCES, SELECT, TRUNCATE, UPDATE ON LOAD_PI_TEAMS_MEMBERSHIP_HISTORY_VW TO PUREINSIGHTS_DEV_POC;

