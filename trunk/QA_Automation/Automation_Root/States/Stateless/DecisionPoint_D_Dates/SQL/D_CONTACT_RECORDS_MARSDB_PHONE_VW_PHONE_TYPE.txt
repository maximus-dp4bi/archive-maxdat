SELECT PHONE_TYPE
     FROM (SELECT PHN.PHONE_NUMBER,PHN.DOES_NOT_WORK_IND
                ,PHN.PHONE_TYPE
                ,PHN.SMS_ENABLED_IND
                ,PHN.PRIMARY_INDICATOR
                ,PHN.PROJECT_ID,CNO.EXTERNAL_REF_ID
                ,CT.CONTACT_TYPE_ID
                ,CNO.EXTERNAL_REF_TYPE
                ,PHN.PHONE_ID
                ,RANK() OVER (PARTITION BY CNO.EXTERNAL_REF_ID, CT.PROJECT_ID ORDER BY DECODE(PRIMARY_INDICATOR,1,1,DECODE(UPPER(PHONE_TYPE),'PRIMARY',2,'HOME',3,'CELL',4,5)), PHN.EFFECTIVE_END_DATE DESC NULLS FIRST,PHN.PHONE_ID) prnk
           FROM  MARSDB.MARSDB_CONTACTS_OWNER_VW CNO
             LEFT JOIN MARSDB.MARSDB_CONTACTS_VW CT ON CNO.CONTACT_OWNER_ID = CT.OWNER_ID AND CT.PROJECT_ID = CNO.PROJECT_ID AND CT.CONTACT_TYPE = 'PHONE'
             LEFT JOIN MARSDB.MARSDB_PHONE_VW PHN ON PHN.CONTACT_TYPE_ID = CT.CONTACT_TYPE_ID AND PHN.PROJECT_ID = CT.PROJECT_ID
           WHERE UPPER(CNO.EXTERNAL_REF_TYPE) = 'CONSUMER')  as CP
     WHERE prnk = 1
AND CP.PROJECT_ID = 419
AND CP.EXTERNAL_REF_ID = '121136';