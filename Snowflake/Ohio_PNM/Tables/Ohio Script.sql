// as Sysadmin
use role SYSADMIN;

// Create Databases
create database OHIO_PROVIDER_DP4BI_DEV_DB;
create database OHIO_PROVIDER_DP4BI_UAT_DB;
//create database OHIO_PROVIDER_DP4BI_PROD_DB;

// If you want to create a schema
create schema <schema name>;

// Create Warehouse
CREATE WAREHOUSE OHIO_PROVIDER_DP4BI_DEV_WH WITH 
WAREHOUSE_SIZE = 'XSMALL' 
WAREHOUSE_TYPE = 'STANDARD' 
AUTO_SUSPEND = 60 
AUTO_RESUME = TRUE 
MIN_CLUSTER_COUNT = 1 
MAX_CLUSTER_COUNT = 1 
SCALING_POLICY = 'STANDARD'
INITIALLY_SUSPENDED = TRUE;

CREATE WAREHOUSE OHIO_PROVIDER_DP4BI_UAT_WH WITH 
WAREHOUSE_SIZE = 'XSMALL' 
WAREHOUSE_TYPE = 'STANDARD' 
AUTO_SUSPEND = 60 
AUTO_RESUME = TRUE 
MIN_CLUSTER_COUNT = 1 
MAX_CLUSTER_COUNT = 1 
SCALING_POLICY = 'STANDARD'
INITIALLY_SUSPENDED = TRUE;

// change to security Admin role
use role SECURITYADMIN;

// Create the roles
// Project's Standard Roles
CREATE ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN;
CREATE ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN;
//CREATE ROLE OHIO_PROVIDER_DP4BI_PROD_ADMIN;
CREATE ROLE OHIO_PROVIDER_DP4BI_DEV_READ;
CREATE ROLE OHIO_PROVIDER_DP4BI_UAT_READ;
//CREATE ROLE OHIO_PROVIDER_DP4BI_PROD_READ;

// Project's Specific Roles
//CREATE ROLE OHIO_PROVIDER_DP4BI_DEV; (it might cause visibility problems)
CREATE ROLE OHIO_PROVIDER_DP4BI_PHI_PII;

// Grant permissions to standard roles
// Dev Admin
GRANT ALL ON WAREHOUSE OHIO_PROVIDER_DP4BI_DEV_WH TO ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN WITH GRANT OPTION;
GRANT ALL ON DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN WITH GRANT OPTION;
GRANT ALL ON ALL SCHEMAS IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN WITH GRANT OPTION;
GRANT ALL ON ALL TABLES IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN WITH GRANT OPTION;
GRANT ALL ON FUTURE TABLES IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN WITH GRANT OPTION;
GRANT ALL ON ALL VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN WITH GRANT OPTION;
GRANT ALL ON FUTURE VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN WITH GRANT OPTION;

// Dev Read
GRANT MONITOR,OPERATE, USAGE ON WAREHOUSE OHIO_PROVIDER_DP4BI_DEV_WH TO ROLE OHIO_PROVIDER_DP4BI_DEV_READ WITH GRANT OPTION;
GRANT MONITOR,REFERENCE_USAGE, USAGE ON DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_READ WITH GRANT OPTION;
GRANT MONITOR, USAGE ON ALL SCHEMAS IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON ALL TABLES IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON FUTURE TABLES IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON ALL VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON FUTURE VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_DEV_DB TO ROLE OHIO_PROVIDER_DP4BI_DEV_READ WITH GRANT OPTION;

// UAT Admin
GRANT ALL ON WAREHOUSE OHIO_PROVIDER_DP4BI_UAT_WH TO ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN WITH GRANT OPTION;
GRANT ALL ON DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN WITH GRANT OPTION;
GRANT ALL ON ALL SCHEMAS IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN WITH GRANT OPTION;
GRANT ALL ON ALL TABLES IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN WITH GRANT OPTION;
GRANT ALL ON FUTURE TABLES IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN WITH GRANT OPTION;
GRANT ALL ON ALL VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN WITH GRANT OPTION;
GRANT ALL ON FUTURE VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN WITH GRANT OPTION;

// UAT Read
GRANT MONITOR,OPERATE, USAGE ON WAREHOUSE OHIO_PROVIDER_DP4BI_UAT_WH TO ROLE OHIO_PROVIDER_DP4BI_UAT_READ WITH GRANT OPTION;
GRANT MONITOR,REFERENCE_USAGE, USAGE ON DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_READ WITH GRANT OPTION;
GRANT MONITOR, USAGE ON ALL SCHEMAS IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON ALL TABLES IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON FUTURE TABLES IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON ALL VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_READ WITH GRANT OPTION;
GRANT SELECT, REFERENCES ON FUTURE VIEWS IN DATABASE OHIO_PROVIDER_DP4BI_UAT_DB TO ROLE OHIO_PROVIDER_DP4BI_UAT_READ WITH GRANT OPTION;

// Grant roles to Project's Specific roles
GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN TO ROLE OHIO_PROVIDER_DP4BI_DEV;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_READ TO ROLE OHIO_PROVIDER_DP4BI_DEV;

// Grant Roles to Sysadmin (optional. I didn't grant at the moment)
//GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN TO ROLE SYSADMIN;
//GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN TO ROLE SYSADMIN;

// Create the user (optional)
/*CREATE USER <user firstname initial+user lastname>
       PASSWORD = <supply password>
       LOGIN_NAME = <login>
       DISPLAY_NAME = <display name>
       FIRST_NAME = <user first name>
       LAST_NAME = <user last name>
       EMAIL = <user email> 
       DEFAULT_ROLE = "SYSADMIN" 
       DEFAULT_WAREHOUSE = 'DEVIN_GRP_WH' 
       DEFAULT_NAMESPACE = 'DEVIN_GRP_DB.PUBLIC' 
       MUST_CHANGE_PASSWORD = TRUE;

// If you want to change the default information
alter user <username> set DEFAULT_ROLE = "MARS_DP4BI_DEV" ;
alter user <username> set DEFAULT_WAREHOUSE = 'MARS_DP4BI_DEV_WH' ;
alter user <username> set DEFAULT_NAMESPACE = 'MARS_DP4BI_DEV.PUBLIC';
*/

// Grant the role to the user
GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER ALINCHANGCO;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN to USER ALINCHANGCO;
GRANT ROLE OHIO_PROVIDER_DP4BI_DEV to USER ALINCHANGCO;

GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER DHEIMBUCH;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN to USER DHEIMBUCH;
GRANT ROLE OHIO_PROVIDER_DP4BI_DEV to USER DHEIMBUCH;

GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER CLAPRANO;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN to USER CLAPRANO;

GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER JMUNAGALA;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN to USER JMUNAGALA;

GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER LALEXANDER;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN to USER LALEXANDER;

GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER RSUNDAR;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN to USER RSUNDAR;

GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER SSATHIRAJU;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_READ to USER SSATHIRAJU;

GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN to USER TAMCCRACKEN;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_READ to USER TAMCCRACKEN;

// If you want to change the default information
alter user SSATHIRAJU set DEFAULT_ROLE = "OHIO_PROVIDER_DP4BI_DEV_ADMIN" ;
alter user SSATHIRAJU set DEFAULT_WAREHOUSE = 'OHIO_PROVIDER_DP4BI_DEV_WH' ;
alter user SSATHIRAJU set DEFAULT_NAMESPACE = 'OHIO_PROVIDER_DP4BI_DEV_DB.PUBLIC';

alter user TAMCCRACKEN set DEFAULT_ROLE = "OHIO_PROVIDER_DP4BI_DEV_ADMIN" ;
alter user TAMCCRACKEN set DEFAULT_WAREHOUSE = 'OHIO_PROVIDER_DP4BI_DEV_WH' ;
alter user TAMCCRACKEN set DEFAULT_NAMESPACE = 'OHIO_PROVIDER_DP4BI_DEV_DB.PUBLIC';


// Service Accounts
CREATE USER SVC_OHIO_PROVIDER_DP4BI_DEV_MSTR_USER
       PASSWORD = 'r(.ERX5Fyeuy=#^*D;>p%5>E7j;53/59' 
       LOGIN_NAME = 'SVC_OHIO_PROVIDER_DP4BI_DEV_MSTR_USER'
       DISPLAY_NAME = 'SVC_OHIO_PROVIDER_DP4BI_DEV_MSTR_USER' 
       DEFAULT_ROLE = "OHIO_PROVIDER_DP4BI_DEV_READ" 
       DEFAULT_WAREHOUSE = 'OHIO_PROVIDER_DP4BI_DEV_WH' 
       DEFAULT_NAMESPACE = 'OHIO_PROVIDER_DP4BI_DEV_DB.PUBLIC';
       
CREATE USER SVC_OHIO_PROVIDER_DP4BI_UAT_MSTR_USER
       PASSWORD = 'CW}.q`5_~@TV.e?\szQPFKAFPaq+&\K1' 
       LOGIN_NAME = 'SVC_OHIO_PROVIDER_DP4BI_UAT_MSTR_USER'
       DISPLAY_NAME = 'SVC_OHIO_PROVIDER_DP4BI_UAT_MSTR_USER' 
       DEFAULT_ROLE = "OHIO_PROVIDER_DP4BI_UAT_READ" 
       DEFAULT_WAREHOUSE = 'OHIO_PROVIDER_DP4BI_UAT_WH' 
       DEFAULT_NAMESPACE = 'OHIO_PROVIDER_DP4BI_UAT_DB.PUBLIC';
       
CREATE USER SVC_OHIO_PROVIDER_DP4BI_DEV_STREAMSETS_USER
       PASSWORD = 'UR#e_()>aM@,RBmbj}!G&\GVEd>U]qL1' 
       LOGIN_NAME = 'SVC_OHIO_PROVIDER_DP4BI_DEV_STREAMSETS_USER'
       DISPLAY_NAME = 'SVC_OHIO_PROVIDER_DP4BI_DEV_STREAMSETS_USER' 
       DEFAULT_ROLE = "OHIO_PROVIDER_DP4BI_DEV_ADMIN" 
       DEFAULT_WAREHOUSE = 'OHIO_PROVIDER_DP4BI_DEV_WH' 
       DEFAULT_NAMESPACE = 'OHIO_PROVIDER_DP4BI_DEV_DB.PUBLIC';
       
CREATE USER SVC_OHIO_PROVIDER_DP4BI_UAT_STREAMSETS_USER
       PASSWORD = 'L?Dd&Z;E\4+xs?"ZYnQvhns?3$ArCbC%' 
       LOGIN_NAME = 'SVC_OHIO_PROVIDER_DP4BI_UAT_STREAMSETS_USER'
       DISPLAY_NAME = 'SVC_OHIO_PROVIDER_DP4BI_UAT_STREAMSETS_USER' 
       DEFAULT_ROLE = "OHIO_PROVIDER_DP4BI_UAT_ADMIN" 
       DEFAULT_WAREHOUSE = 'OHIO_PROVIDER_DP4BI_UAT_WH' 
       DEFAULT_NAMESPACE = 'OHIO_PROVIDER_DP4BI_UAT_DB.PUBLIC';

// Grant role to the users
GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_READ TO USER SVC_OHIO_PROVIDER_DP4BI_DEV_MSTR_USER;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_READ TO USER SVC_OHIO_PROVIDER_DP4BI_UAT_MSTR_USER;
GRANT ROLE OHIO_PROVIDER_DP4BI_DEV_ADMIN TO USER SVC_OHIO_PROVIDER_DP4BI_DEV_STREAMSETS_USER;
GRANT ROLE OHIO_PROVIDER_DP4BI_UAT_ADMIN TO USER SVC_OHIO_PROVIDER_DP4BI_UAT_STREAMSETS_USER;
