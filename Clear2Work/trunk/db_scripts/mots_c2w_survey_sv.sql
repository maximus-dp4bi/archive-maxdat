--Create View

CREATE or REPLACE VIEW MOTS.CLEAR2WORK_SURVEY_SV
AS SELECT
   ASSIGNEE_ID,
   TO_CHAR(TO_DATE(SUBSTR(ltrim(rtrim(SUBMISSION_TIME)),1,19),'YYYY-MM-DD HH24:MI:SS'),'MON DD, YYYY HH:MI:SS AM') AS SUBMISSION_TIME,
   EMP_ID,
   SITE_NAME,
   CLEAR_IND,
   NOT_CLEAR_IND,
   ASSIGNEE_NAME,
   ABOUT_USER_ID,
   ABOUT_USER_NAME,
   TO_CHAR(TO_DATE(SUBSTR(ltrim(rtrim(START_TIME)),1,19),'YYYY-MM-DD HH24:MI:SS'),'MON DD, YYYY HH:MI:SS AM') AS START_TIME,
   COMPLETED_BY_USER_ID,
   COMPLETED_BY_USER_NAME
FROM CLEAR2WORK_SURVEY
WHERE SURVEY_DATE >= TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD')
		             - (SELECT TO_NUMBER(COALESCE(MAX(PARAM_VALUE),'2000'))
                        FROM CLEAR2WORK_GLOBAL_CONFIG gc
                        WHERE gc.PARAM_KEY = 'SURVEY_VIEW_DATA_DAYS') WITH READ ONLY;


-- grant select on the view 
GRANT SELECT ON CLEAR2WORK_SITE_SV to MOTS_READ_ONLY;